<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PES ELITE | Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙƒØ§Ù…Ù„</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --main: #eaff00; --bg: #050508; --card: #12121a; --error: #ff3333; }
        body { background: var(--bg); color: #fff; font-family: 'Cairo', sans-serif; margin: 0; padding: 20px; text-align: right; }
        .wrapper { max-width: 800px; margin: auto; }
        .card { background: var(--card); border: 1px solid #222; border-radius: 15px; padding: 25px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h2 { color: var(--main); border-right: 4px solid var(--main); padding-right: 15px; margin-top: 0; }
        label { display: block; margin-bottom: 8px; color: #888; font-size: 0.9rem; }
        select, input { width: 100%; background: #000; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 8px; margin-bottom: 20px; font-family: 'Cairo'; box-sizing: border-box; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; transition: 0.3s; font-size: 1rem; font-family: 'Cairo'; }
        .btn-save { background: var(--main); color: #000; }
        .btn-init { background: #222; color: #fff; border: 2px dashed var(--main); margin-bottom: 30px; }
        .btn-init:hover { background: var(--main); color: #000; }
        .alert-info { background: #1a1a00; border: 1px solid var(--main); padding: 15px; border-radius: 8px; color: var(--main); margin-bottom: 20px; font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="wrapper">
    <h1>ğŸ® Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… PES ELITE</h1>

    <div id="initAlert" class="card" style="border: 2px solid var(--main); display: block;">
        <h3 style="margin-top:0">âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ø§Ù…</h3>
        <p>Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… (Select) ÙØ§Ø±ØºØ© ÙˆÙ„Ø§ ØªØ¸Ù‡Ø± Ø¨Ù‡Ø§ Ø£ÙŠ Ø£Ø³Ù…Ø§Ø¡ØŒ ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø¨Ø§Ù„Ø£Ø³ÙÙ„ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù€ 15 Ø®Ø§Ù†Ø© Ù„Ø£ÙˆÙ„ Ù…Ø±Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</p>
        <button class="btn btn-init" onclick="setupNewLeague()">Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ø¯ÙˆØ±ÙŠ (Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù€ 15 Ø®Ø§Ù†Ø© Ø§Ù„Ø¢Ù†)</button>
    </div>

    <div class="card">
        <h2>ğŸ“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ (Ø§Ù„Ù€ 15 Ø®Ø§Ù†Ø©)</h2>
        <label>Ø§Ø®ØªØ± "ÙØ±ÙŠÙ‚ X" Ù„ØªØºÙŠÙŠØ± Ø§Ø³Ù…Ù‡ Ù„Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ:</label>
        <select id="editSelect"><option>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø§Ù†Ø§Øª...</option></select>
        <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯:</label>
        <input type="text" id="newName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù‡Ù†Ø§...">
        <button class="btn" style="background: white; color: black;" onclick="updateTeam()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù… ÙÙˆØ±Ø§Ù‹ ğŸ”„</button>
    </div>

    <div class="card">
        <h2>âš½ ØªØ³Ø¬ÙŠÙ„ Ù†ØªÙŠØ¬Ø© Ù…Ø¨Ø§Ø±Ø§Ø©</h2>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div>
                <label>Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„</label>
                <select id="t1"></select>
            </div>
            <div>
                <label>Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ</label>
                <select id="t2"></select>
            </div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <input type="number" id="s1" placeholder="Ø£Ù‡Ø¯Ø§Ù 1">
            <input type="number" id="s2" placeholder="Ø£Ù‡Ø¯Ø§Ù 2">
        </div>
        <button class="btn btn-save" onclick="recordMatch()">Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ±ØªÙŠØ¨ âœ…</button>
    </div>

</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCYAtj7gB7bfXPPSRojddCzhIyUMN7Tnow",
        authDomain: "pes-elite.firebaseapp.com",
        projectId: "pes-elite",
        storageBucket: "pes-elite.firebasestorage.app",
        messagingSenderId: "407069539120",
        appId: "1:407069539120:web:466249fa7f716266d9e6f5"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
    function init() {
        db.collection("MainLeague").orderBy("id").onSnapshot(snap => {
            if (snap.empty) {
                document.getElementById('initAlert').style.display = 'block';
                return;
            }
            document.getElementById('initAlert').style.display = 'none';
            let html = '<option value="">-- Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© --</option>';
            snap.forEach(doc => {
                html += `<option value="${doc.id}">${doc.data().name}</option>`;
            });
            document.getElementById('t1').innerHTML = html;
            document.getElementById('t2').innerHTML = html;
            document.getElementById('editSelect').innerHTML = html;
        });
    }

    // Ø§Ù„Ø²Ø±Ø§Ø± Ø§Ù„Ø³Ø­Ø±ÙŠ Ø§Ù„Ù„ÙŠ Ø¨ÙŠÙØªØ­ Ø§Ù„Ø®Ø§Ù†Ø§Øª
    async function setupNewLeague() {
        if(!confirm("Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ 15 Ø®Ø§Ù†Ø© ÙØ§Ø±ØºØ© ÙÙŠ Ø§Ù„Ø¯ÙˆØ±ÙŠ. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) return;
        
        // ØªÙ†Ø¸ÙŠÙ Ù‚Ø¯ÙŠÙ… Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯
        const oldL = await db.collection("MainLeague").get();
        for(let doc of oldL.docs) await db.collection("MainLeague").doc(doc.id).delete();
        
        // Ø¥Ù†Ø´Ø§Ø¡ 15 Ø®Ø§Ù†Ø©
        for(let i=1; i<=15; i++) {
            await db.collection("MainLeague").doc("team"+i).set({
                id: i,
                name: "ÙØ±ÙŠÙ‚ " + i,
                played: 0,
                pts: 0,
                gd: 0
            });
        }
        alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù€ 15 Ø®Ø§Ù†Ø©! Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ø¢Ù†.");
    }

    async function updateTeam() {
        const id = document.getElementById('editSelect').value;
        const name = document.getElementById('newName').value;
        if(!id || !name) return alert("Ø§Ø®ØªØ± Ø§Ù„Ø®Ø§Ù†Ø© ÙˆØ§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯!");
        await db.collection("MainLeague").doc(id).update({ name: name });
        alert("ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù… Ø¨Ù†Ø¬Ø§Ø­!");
        document.getElementById('newName').value = '';
    }

    async function recordMatch() {
        const id1 = document.getElementById('t1').value, id2 = document.getElementById('t2').value;
        const s1 = parseInt(document.getElementById('s1').value), s2 = parseInt(document.getElementById('s2').value);
        if(!id1 || !id2 || isNaN(s1)) return alert("Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ù…Ù„Ø©!");
        
        const n1 = document.querySelector(`#t1 option[value="${id1}"]`).text;
        const n2 = document.querySelector(`#t2 option[value="${id2}"]`).text;

        await db.collection("AllMatches").add({ t1: n1, t2: n2, s1, s2, time: Date.now() });
        await updateStats(id1, s1, s2);
        await updateStats(id2, s2, s1);
        alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†ØªÙŠØ¬Ø©!");
    }

    async function updateStats(id, gf, ga) {
        const ref = db.collection("MainLeague").doc(id);
        const d = (await ref.get()).data();
        let win = gf > ga ? 1 : 0, draw = gf === ga ? 1 : 0;
        await ref.update({
            played: (d.played || 0) + 1,
            pts: (d.pts || 0) + (win * 3 + draw),
            gd: (d.gd || 0) + (gf - ga)
        });
    }

    init();
</script>
</body>
</html>
