<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PES ELITE | PRO ADMIN SYSTEM</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --ef-blue: #0014d3; --ef-yellow: #eaff00; --ef-pink: #ff007a;
            --dark-bg: #050508; --card-bg: #111118;
        }
        body { margin: 0; font-family: 'Cairo', sans-serif; background: var(--dark-bg); color: white; display: flex; }
        
        .sidebar { width: 280px; background: #000; border-left: 1px solid #222; height: 100vh; position: fixed; padding: 20px; z-index: 100; }
        .sidebar-header { font-family: 'Orbitron'; font-size: 22px; color: var(--ef-yellow); border-bottom: 2px solid var(--ef-pink); padding-bottom: 15px; margin-bottom: 20px; text-align: center; }
        
        .nav-link { 
            width: 100%; padding: 15px; margin-bottom: 8px; border-radius: 10px; border: none; 
            background: none; color: #888; text-align: right; cursor: pointer; transition: 0.3s;
            display: flex; align-items: center; gap: 12px; font-weight: bold;
        }
        .nav-link:hover, .nav-link.active { background: var(--ef-blue); color: white; box-shadow: 0 5px 15px rgba(0,20,211,0.4); }

        .content { margin-right: 280px; flex: 1; padding: 40px; }
        .admin-section { display: none; animation: slideUp 0.4s ease; }
        .admin-section.active { display: block; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .glass-card { background: var(--card-bg); padding: 25px; border-radius: 20px; border: 1px solid #222; margin-bottom: 25px; }
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-box { background: var(--card-bg); padding: 20px; border-radius: 15px; border-bottom: 4px solid var(--ef-blue); text-align: center; }
        .stat-box h3 { font-size: 14px; color: #666; margin: 0; }
        .stat-box p { font-size: 28px; font-family: 'Orbitron'; margin: 10px 0 0; color: var(--ef-yellow); }

        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; color: #aaa; font-size: 14px; }
        input, select { width: 100%; padding: 12px; background: #1a1a25; border: 1px solid #333; color: white; border-radius: 8px; outline: none; box-sizing: border-box; }
        .btn-action { width: 100%; padding: 15px; background: var(--ef-pink); border: none; color: white; font-weight: 900; border-radius: 8px; cursor: pointer; margin-top: 10px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #000; border-radius: 10px; overflow: hidden; }
        th { background: #1a1a25; padding: 15px; color: var(--ef-yellow); text-align: center; }
        td { padding: 15px; text-align: center; border-bottom: 1px solid #111; }
        .btn-delete { color: #ff4d4d; cursor: pointer; background: none; border: none; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header">PES ELITE HUB</div>
        <button class="nav-link active" onclick="openTab('overview')"><i class="fas fa-home"></i> الرئيسية</button>
        <button class="nav-link" onclick="openTab('tournaments')"><i class="fas fa-trophy"></i> إدارة البطولات</button>
        <button class="nav-link" onclick="openTab('players')"><i class="fas fa-user-plus"></i> إدارة اللاعبين</button>
        <button class="nav-link" onclick="openTab('results')"><i class="fas fa-file-invoice"></i> تسجيل النتائج</button>
        <button class="nav-link" onclick="openTab('news')"><i class="fas fa-rss"></i> الأخبار والسيستم</button>
        <button class="nav-link" style="color:var(--ef-pink); margin-top:100px;" onclick="auth.signOut()"><i class="fas fa-power-off"></i> خروج</button>
    </div>

    <div class="content">
        <div id="overview" class="admin-section active">
            <h1 style="font-family:'Orbitron'">DASHBOARD OVERVIEW</h1>
            <div class="stats-grid">
                <div class="stat-box"><h3>البطولات</h3><p id="stat-tours">0</p></div>
                <div class="stat-box"><h3>اللاعبين</h3><p id="stat-players">0</p></div>
                <div class="stat-box"><h3>المباريات</h3><p id="stat-matches">0</p></div>
                <div class="stat-box"><h3>الجوائز</h3><p id="stat-awards">120K</p></div>
            </div>
            <div class="glass-card">
                <h2>آخر اللاعبين المنضمين</h2>
                <table>
                    <thead><tr><th>اللاعب</th><th>الحساب</th><th>ID</th><th>الإجراء</th></tr></thead>
                    <tbody id="pList"></tbody>
                </table>
            </div>
        </div>

        <div id="tournaments" class="admin-section">
            <div class="glass-card">
                <h2><i class="fas fa-plus-circle"></i> إنشاء بطولة جديدة</h2>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                    <div class="form-group"><label>اسم البطولة</label><input type="text" id="tourName"></div>
                    <div class="form-group"><label>رابط اللوجو</label><input type="text" id="tourLogo"></div>
                    <div class="form-group">
                        <label>نوع البطولة</label>
                        <select id="tourType"><option value="league">دوري (نقاط)</option><option value="knockout">خروج مغلوب</option></select>
                    </div>
                    <div class="form-group"><label>الجائزة</label><input type="text" id="tourPrize"></div>
                </div>
                <button class="btn-action" onclick="addTournament()">إضافة البطولة</button>
            </div>
            <div class="glass-card">
                <h2>البطولات الجارية</h2>
                <table>
                    <thead><tr><th>اللوجو</th><th>الاسم</th><th>النوع</th><th>الإجراء</th></tr></thead>
                    <tbody id="tList"></tbody>
                </table>
            </div>
        </div>

        <div id="news" class="admin-section">
            <div class="glass-card">
                <h2><i class="fas fa-rss"></i> تحديث الأخبار العالمية</h2>
                <input type="text" id="globalNews" placeholder="اكتب الخبر الجديد...">
                <button class="btn-action" onclick="saveNews()">نشر الآن</button>
            </div>
        </div>

        <div id="results" class="admin-section">
            <div class="glass-card">
                <h2><i class="fas fa-futbol"></i> تسجيل نتيجة مباراة</h2>
                <div class="form-group">
                    <label>اختر البطولة</label>
                    <select id="matchTourId"></select>
                </div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
                    <div class="form-group"><label>اللاعب 1</label><input type="text" id="resP1"></div>
                    <div class="form-group"><label>اللاعب 2</label><input type="text" id="resP2"></div>
                    <div class="form-group"><label>أهداف 1</label><input type="number" id="resS1"></div>
                    <div class="form-group"><label>أهداف 2</label><input type="number" id="resS2"></div>
                </div>
                <button class="btn-action" style="background:var(--ef-blue)" onclick="saveMatch()">اعتماد النتيجة</button>
            </div>
        </div>

        <div id="players" class="admin-section">
            <div class="glass-card">
                <h2><i class="fas fa-user-edit"></i> إضافة لاعب يدوياً</h2>
                <div class="form-group"><label>Nickname</label><input type="text" id="addName"></div>
                <div class="form-group"><label>E-Football ID</label><input type="text" id="addID"></div>
                <button class="btn-action" onclick="addPlayer()">إضافة للنظام</button>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCYAtj7gB7bfXPPSRojddCzhIyUMN7Tnow",
            authDomain: "pes-elite.firebaseapp.com",
            projectId: "pes-elite",
            storageBucket: "pes-elite.firebasestorage.app",
            messagingSenderId: "407069539120",
            appId: "1:407069539120:web:466249fa7f716266d9e6f5"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(), auth = firebase.auth();

        auth.onAuthStateChanged(user => {
            if(!user || user.email !== "mtag1337@gmail.com") window.location.href="login.html";
            else { loadStats(); loadTournaments(); }
        });

        function openTab(id) {
            document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        function loadStats() {
            db.collection("players").onSnapshot(s => {
                document.getElementById('stat-players').innerText = s.size;
                let html = "";
                s.forEach(doc => {
                    const p = doc.data();
                    html += `<tr><td>${p.nickname}</td><td>${p.email || 'يدوي'}</td><td>${p.efootballId}</td><td><button class="btn-delete" onclick="deleteDoc('players','${doc.id}')"><i class="fas fa-trash"></i></button></td></tr>`;
                });
                document.getElementById('pList').innerHTML = html;
            });
            db.collection("leagueMatches").onSnapshot(s => document.getElementById('stat-matches').innerText = s.size);
            db.collection("tournaments").onSnapshot(s => document.getElementById('stat-tours').innerText = s.size);
        }

        // --- Tournament Functions ---
        async function addTournament() {
            const tour = {
                name: document.getElementById('tourName').value,
                logo: document.getElementById('tourLogo').value,
                type: document.getElementById('tourType').value,
                prize: document.getElementById('tourPrize').value,
                active: true
            };
            await db.collection("tournaments").add(tour);
            alert("تمت إضافة البطولة!");
        }

        function loadTournaments() {
            db.collection("tournaments").onSnapshot(s => {
                let listHtml = ""; let selectHtml = "";
                s.forEach(doc => {
                    const t = doc.data();
                    listHtml += `<tr><td><img src="${t.logo}" width="30"></td><td>${t.name}</td><td>${t.type}</td><td><button class="btn-delete" onclick="deleteDoc('tournaments','${doc.id}')"><i class="fas fa-trash"></i></button></td></tr>`;
                    selectHtml += `<option value="${doc.id}">${t.name}</option>`;
                });
                document.getElementById('tList').innerHTML = listHtml;
                document.getElementById('matchTourId').innerHTML = selectHtml;
            });
        }

        // --- Shared Functions ---
        async function saveMatch() {
            const match = {
                tournamentId: document.getElementById('matchTourId').value,
                player1: document.getElementById('resP1').value,
                player2: document.getElementById('resP2').value,
                score1: document.getElementById('resS1').value,
                score2: document.getElementById('resS2').value,
                time: firebase.firestore.FieldValue.serverTimestamp()
            };
            await db.collection("leagueMatches").add(match);
            alert("تم تسجيل النتيجة بنجاح!");
        }

        async function saveNews() {
            const news = document.getElementById('globalNews').value;
            await db.collection("settings").doc("leagueConfig").set({ news: news }, { merge: true });
            alert("تم النشر!");
        }

        async function addPlayer() {
            await db.collection("players").add({
                nickname: document.getElementById('addName').value,
                efootballId: document.getElementById('addID').value,
                joinedAt: new Date()
            });
            alert("تمت الإضافة!");
        }

        async function deleteDoc(col, id) {
            if(confirm("هل أنت متأكد؟")) await db.collection(col).doc(id).delete();
        }
    </script>
</body>
</html>
