<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>PES ELITE | Admin Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <style>
        :root { --main: #eaff00; --bg: #050508; --card: #12121a; }
        body { background: var(--bg); color: #fff; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .card { background: var(--card); border: 1px solid var(--main); padding: 25px; border-radius: 15px; width: 100%; max-width: 500px; margin-bottom: 20px; text-align: center; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #333; background: #000; color: #fff; box-sizing: border-box; }
        .btn { width: 100%; padding: 15px; background: var(--main); color: #000; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        #main-ui { display: none; width: 100%; max-width: 800px; }
    </style>
</head>
<body>
    <div id="auth-gate" class="card">
        <h2>ğŸ”’ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†</h2>
        <button class="btn" onclick="login()">Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Google</button>
        <div id="pass-step" style="display:none; margin-top:20px;">
            <input type="password" id="admin-pass" placeholder="ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ù„ÙˆØ­Ø©">
            <button class="btn" onclick="verifyPass()">ÙØªØ­ Ø§Ù„Ù„ÙˆØ­Ø©</button>
        </div>
    </div>

    <div id="main-ui">
        <div class="card" style="max-width:none">
            <h2 style="color:var(--main)">âš½ ØªØ³Ø¬ÙŠÙ„ Ù†ØªÙŠØ¬Ø©</h2>
            <div style="display:flex; gap:10px">
                <select id="t1"></select> <select id="t2"></select>
            </div>
            <div style="display:flex; gap:10px">
                <input type="number" id="s1" placeholder="Ø£Ù‡Ø¯Ø§Ù 1"> <input type="number" id="s2" placeholder="Ø£Ù‡Ø¯Ø§Ù 2">
            </div>
            <button class="btn" onclick="saveMatch()">Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© âœ…</button>
        </div>

        <div class="card" style="max-width:none">
            <h2 style="color:var(--main)">ğŸ“ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</h2>
            <select id="editSelect"></select>
            <input type="text" id="newName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯">
            <button class="btn" style="background:#fff" onclick="updateName()">ØªØ­Ø¯ÙŠØ« ğŸ”„</button>
        </div>

        <div class="card" style="max-width:none; border-color:red">
            <button class="btn" style="background:red; color:#fff" onclick="resetLeague()">ğŸš¨ ØªØµÙÙŠØ± Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</button>
        </div>
    </div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyCYAtj7gB7bfXPPSRojddCzhIyUMN7Tnow", authDomain: "pes-elite.firebaseapp.com", projectId: "pes-elite", storageBucket: "pes-elite.firebasestorage.app", messagingSenderId: "407069539120", appId: "1:407069539120:web:466249fa7f716266d9e6f5" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore(); const auth = firebase.auth();
    const SECRET = "123456";

    function login() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
    function verifyPass() { if(document.getElementById('admin-pass').value === SECRET) { document.getElementById('auth-gate').style.display='none'; document.getElementById('main-ui').style.display='block'; load(); } }

    auth.onAuthStateChanged(user => { if(user && user.email === "mtag1337@gmail.com") document.getElementById('pass-step').style.display='block'; });

    function load() {
        db.collection("MainLeague").orderBy("id").onSnapshot(s => {
            let h = ''; s.forEach(d => h += `<option value="${d.id}">${d.data().name}</option>`);
            document.getElementById('t1').innerHTML = h; document.getElementById('t2').innerHTML = h; document.getElementById('editSelect').innerHTML = h;
        });
    }

    async function saveMatch() {
        const id1 = document.getElementById('t1').value, id2 = document.getElementById('t2').value, s1 = parseInt(document.getElementById('s1').value), s2 = parseInt(document.getElementById('s2').value);
        await db.collection("AllMatches").add({t1:id1, t2:id2, s1, s2, time:Date.now()});
        await up(id1, s1, s2); await up(id2, s2, s1); alert("ØªÙ…!");
    }

    async function up(id, gf, ga) {
        const r = db.collection("MainLeague").doc(id), d = (await r.get()).data();
        let w = gf > ga ? 1 : 0, dr = gf === ga ? 1 : 0;
        await r.update({ played: (d.played||0)+1, pts: (d.pts||0)+(w*3+dr), gd: (d.gd||0)+(gf-ga) });
    }

    async function updateName() { await db.collection("MainLeague").doc(document.getElementById('editSelect').value).update({name: document.getElementById('newName').value}); alert("ØªÙ…!"); }
    
    async function resetLeague() {
        if(!confirm("Ù…Ø³Ø­ØŸ")) return;
        for(let i=1; i<=15; i++) await db.collection("MainLeague").doc("team"+i).set({id:i, name:"ÙØ±ÙŠÙ‚ "+i, played:0, pts:0, gd:0});
        alert("Ø¯ÙˆØ±ÙŠ Ø¬Ø¯ÙŠØ¯ Ø¬Ø§Ù‡Ø²!");
    }
</script>
</body>
</html>
