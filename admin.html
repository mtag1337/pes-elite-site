<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PES ELITE | Admin</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <style>
        :root { --p: #eaff00; --bg: #050508; --c: #12121a; }
        body { background: var(--bg); color: white; font-family: sans-serif; padding: 20px; }
        .panel { background: var(--c); padding: 20px; border-radius: 12px; border: 1px solid #222; margin-bottom: 20px; max-width: 600px; margin-right: auto; margin-left: auto; }
        h2, h3 { color: var(--p); text-align: center; }
        select, input, button { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: none; font-size: 1rem; box-sizing: border-box; }
        button { background: var(--p); color: black; font-weight: bold; cursor: pointer; }
        .danger { background: #ff3333; color: white; margin-top: 40px; }
    </style>
</head>
<body>

    <div class="panel">
        <h2>ğŸ® Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… PES ELITE</h2>
        <div style="text-align: center; margin-bottom: 20px;">
            <a href="league.html" style="color: var(--p); text-decoration: none;">ğŸ” Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ±ØªÙŠØ¨</a>
        </div>
        
        <h3>âš½ ØªØ³Ø¬ÙŠÙ„ Ù†ØªÙŠØ¬Ø©</h3>
        <select id="t1"></select>
        <select id="t2"></select>
        <div style="display: flex; gap: 10px;">
            <input type="number" id="s1" placeholder="Ø£Ù‡Ø¯Ø§Ù 1">
            <input type="number" id="s2" placeholder="Ø£Ù‡Ø¯Ø§Ù 2">
        </div>
        <button onclick="recordMatch()">Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
    </div>

    <div class="panel">
        <h3>ğŸ“ Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ÙØ±Ù‚</h3>
        <select id="editSelect"></select>
        <input type="text" id="newName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯">
        <button style="background: white;" onclick="updateTeam()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù…</button>
    </div>

    <div class="panel" style="border-color: red;">
        <h3>ğŸš¨ ØªØµÙÙŠØ± Ø§Ù„Ø¯ÙˆØ±ÙŠ</h3>
        <button class="danger" onclick="setupNewLeague()">Ø¥Ù†Ø´Ø§Ø¡ Ø¯ÙˆØ±ÙŠ Ø¬Ø¯ÙŠØ¯ (15 Ø®Ø§Ù†Ø©)</button>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCYAtj7gB7bfXPPSRojddCzhIyUMN7Tnow",
        authDomain: "pes-elite.firebaseapp.com",
        projectId: "pes-elite",
        storageBucket: "pes-elite.firebasestorage.app",
        messagingSenderId: "407069539120",
        appId: "1:407069539120:web:466249fa7f716266d9e6f5"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function load() {
        db.collection("MainLeague").orderBy("id").onSnapshot(snap => {
            let options = '<option value="">Ø§Ø®ØªØ± ÙØ±ÙŠÙ‚...</option>';
            snap.forEach(doc => { options += `<option value="${doc.id}">${doc.data().name}</option>`; });
            document.getElementById('t1').innerHTML = options;
            document.getElementById('t2').innerHTML = options;
            document.getElementById('editSelect').innerHTML = options;
        });
    }

    async function recordMatch() {
        const id1 = document.getElementById('t1').value, id2 = document.getElementById('t2').value;
        const s1 = parseInt(document.getElementById('s1').value), s2 = parseInt(document.getElementById('s2').value);
        if(!id1 || !id2 || isNaN(s1)) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        
        const n1 = document.querySelector(`#t1 option[value="${id1}"]`).text;
        const n2 = document.querySelector(`#t2 option[value="${id2}"]`).text;

        await db.collection("AllMatches").add({ t1: n1, t2: n2, s1, s2, time: Date.now() });
        await updateStats(id1, s1, s2);
        await updateStats(id2, s2, s1);
        alert("ØªÙ… Ø§Ù„Ø­ÙØ¸!");
    }

    async function updateStats(id, gf, ga) {
        const ref = db.collection("MainLeague").doc(id);
        const d = (await ref.get()).data();
        let w = gf > ga ? 1 : 0, dr = gf === ga ? 1 : 0;
        await ref.update({
            played: (d.played || 0) + 1,
            pts: (d.pts || 0) + (w * 3 + dr),
            gd: (d.gd || 0) + (gf - ga)
        });
    }

    async function updateTeam() {
        const id = document.getElementById('editSelect').value;
        const name = document.getElementById('newName').value;
        if(!id || !name) return alert("Ø§Ø®ØªØ± Ø§Ù„ÙØ±ÙŠÙ‚ ÙˆØ§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù…");
        await db.collection("MainLeague").doc(id).update({ name: name });
        alert("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«");
    }

    async function setupNewLeague() {
        if(!confirm("Ø³ÙŠÙ…Ø³Ø­ ÙƒÙ„ Ø´ÙŠØ¡! Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) return;
        const oldL = await db.collection("MainLeague").get();
        for(let doc of oldL.docs) await db.collection("MainLeague").doc(doc.id).delete();
        const oldH = await db.collection("AllMatches").get();
        for(let doc of oldH.docs) await db.collection("AllMatches").doc(doc.id).delete();
        
        for(let i=1; i<=15; i++) {
            await db.collection("MainLeague").doc("team"+i).set({
                id: i, name: "ÙØ±ÙŠÙ‚ " + i, played: 0, pts: 0, gd: 0
            });
        }
        alert("Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø¬Ø§Ù‡Ø²!");
    }
    load();
</script>
</body>
</html>
