<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>PES Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, getDocs, doc, updateDoc, addDoc, arrayUnion, Timestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    /* ğŸ”´ Ø¶Ø¹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ù‡Ù†Ø§ (Ù†ÙØ³ Ø§Ù„Ù„ÙŠ Gemini Ù…Ø³ØªØ®Ø¯Ù…Ù‡) */
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    /* ================= TOURNAMENTS ================= */
    async function loadTournaments() {
      const container = document.getElementById("tournaments");
      container.innerHTML = "";

      const snap = await getDocs(collection(db, "tournaments"));
      snap.forEach(docSnap => {
        const t = docSnap.data();
        container.innerHTML += `
          <div class="card">
            <img src="${t.img}">
            <h3>${t.name}</h3>
            <p>ğŸ ${t.prize}</p>
            <p>ğŸ‘¥ ${t.joined.length}/${t.max}</p>
            <p>ğŸ“… ${t.date}</p>
          </div>
        `;
      });
    }

    /* ================= PLAYER REQUESTS ================= */
    async function loadRequests() {
      const container = document.getElementById("requests");
      container.innerHTML = "";

      const snap = await getDocs(collection(db, "playerRequests"));
      snap.forEach(docSnap => {
        const r = docSnap.data();
        container.innerHTML += `
          <div class="card">
            <p>ğŸ‘¤ UID: ${r.uid}</p>
            <p>ğŸ† Tournament: ${r.tournamentId}</p>
            <button onclick="acceptPlayer('${docSnap.id}','${r.uid}','${r.tournamentId}')">Ù‚Ø¨ÙˆÙ„</button>
          </div>
        `;
      });
    }

    window.acceptPlayer = async (requestId, uid, tournamentId) => {
      await updateDoc(doc(db, "tournaments", tournamentId), {
        joined: arrayUnion(uid)
      });

      await updateDoc(doc(db, "playerRequests", requestId), {
        status: "accepted"
      });

      await addDoc(collection(db, "players", uid, "notifications"), {
        msg: "âœ… ØªÙ… Ù‚Ø¨ÙˆÙ„Ùƒ ÙÙŠ Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©",
        time: Date.now()
      });

      alert("ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨");
      loadRequests();
    };

    /* ================= PLAYERS ================= */
    window.updatePlayer = async () => {
      const uid = playerUid.value;
      await updateDoc(doc(db, "players", uid), {
        gpPoints: Number(points.value),
        rank: rank.value,
        isVerified: verified.checked
      });
      alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨");
    };

    /* ================= NOTIFICATIONS ================= */
    window.sendNotification = async () => {
      await addDoc(collection(db, "players", notifyUid.value, "notifications"), {
        msg: notifyMsg.value,
        time: Date.now()
      });
      alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±");
    };

    /* ================= TICKER ================= */
    window.updateTicker = async () => {
      await updateDoc(doc(db, "settings", "ticker"), {
        msg: tickerMsg.value
      });
      alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø±ÙŠØ·");
    };

    window.onload = () => {
      loadTournaments();
      loadRequests();
    };
  </script>

  <style>
    body {
      background:#0f172a;
      color:#e5e7eb;
      font-family: Arial;
      margin:0;
      padding:20px;
    }
    h2 { margin-top:40px; }
    .grid {
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(250px,1fr));
      gap:15px;
    }
    .card {
      background:#020617;
      border-radius:12px;
      padding:15px;
      box-shadow:0 0 10px #000;
    }
    img {
      width:100%;
      border-radius:8px;
    }
    input, textarea, button {
      width:100%;
      padding:10px;
      margin-top:8px;
      background:#020617;
      color:#fff;
      border:1px solid #334155;
      border-radius:8px;
    }
    button {
      background:#2563eb;
      cursor:pointer;
    }
    button:hover { opacity:0.9; }
  </style>
</head>

<body>

  <h1>ğŸ® PES Admin Panel</h1>

  <h2>ğŸ† Ø§Ù„Ø¨Ø·ÙˆÙ„Ø§Øª</h2>
  <div id="tournaments" class="grid"></div>

  <h2>ğŸ“© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</h2>
  <div id="requests" class="grid"></div>

  <h2>ğŸ‘¤ Ø¥Ø¯Ø§Ø±Ø© Ù„Ø§Ø¹Ø¨</h2>
  <div class="card">
    <input id="playerUid" placeholder="UID Ø§Ù„Ù„Ø§Ø¹Ø¨">
    <input id="points" type="number" placeholder="GP Points">
    <input id="rank" placeholder="Rank">
    <label><input type="checkbox" id="verified"> Ù…ÙˆØ«Ù‚</label>
    <button onclick="updatePlayer()">Ø­ÙØ¸</button>
  </div>

  <h2>ğŸ”” Ø¥Ø´Ø¹Ø§Ø± Ø®Ø§Øµ</h2>
  <div class="card">
    <input id="notifyUid" placeholder="UID Ø§Ù„Ù„Ø§Ø¹Ø¨">
    <textarea id="notifyMsg" placeholder="Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©"></textarea>
    <button onclick="sendNotification()">Ø¥Ø±Ø³Ø§Ù„</button>
  </div>

  <h2>ğŸ“¢ Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</h2>
  <div class="card">
    <input id="tickerMsg" placeholder="Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø´Ø±ÙŠØ·">
    <button onclick="updateTicker()">ØªØ­Ø¯ÙŠØ«</button>
  </div>

</body>
</html>
