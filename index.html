<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PES ELITE | DASHBOARD</title>

<!-- Ø®Ø·ÙˆØ· ÙˆØ£ÙŠÙ‚ÙˆÙ†Ø§Øª -->
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Orbitron:wght@600;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

<style>
:root {
    --primary: #00ff7f;
    --accent: #1e90ff;
    --bg: #0a0a0a;
    --panel: rgba(15,15,15,0.85);
    --border: rgba(255,255,255,0.08);
    --gold: #FFD700;
}

* { margin:0; padding:0; box-sizing:border-box; font-family:'Cairo', sans-serif; }
body { background: #0a0a0a; color:#fff; overflow-x:hidden; }

#bg-field {
    position: fixed;
    top:0; left:0;
    width:100%; height:100%;
    background: url('https://i.ibb.co/YZsZbVt/pes-field.jpg') center/cover no-repeat;
    filter: brightness(0.35);
    z-index:-1;
}

nav {
    height: 80px;
    background: rgba(0,0,0,0.85);
    border-bottom: 2px solid var(--primary);
    display:flex; align-items:center; justify-content:space-between;
    padding:0 40px; position:sticky; top:0; z-index:1000;
}
.logo { font-family:'Orbitron'; font-size:28px; font-weight:900; }
.logo span { color:var(--primary); text-shadow:0 0 10px var(--primary); }

nav .user-info { display:flex; align-items:center; gap:20px; }
nav .user-info img { width:50px; height:50px; border-radius:50%; border:2px solid var(--primary); }
nav .user-info .rating { font-family:'Orbitron'; font-weight:900; color:var(--primary); font-size:18px; }

.app-container {
    display:grid;
    grid-template-columns: 300px 1fr 300px;
    gap:25px;
    padding:25px;
    max-width:1800px;
    margin:auto;
}

.glass-panel {
    background: var(--panel);
    border:1px solid var(--border);
    border-radius:20px;
    padding:20px;
    backdrop-filter: blur(10px);
    transition:0.3s;
}
.glass-panel:hover { border-color:var(--primary); box-shadow:0 10px 30px rgba(0,255,127,0.2); }

.avatar-ring { width:130px; height:130px; margin:0 auto 15px; border-radius:50%; padding:5px; background:linear-gradient(45deg,var(--primary),var(--accent)); }
.avatar-ring img { width:100%; height:100%; border-radius:50%; border:4px solid var(--bg); object-fit:cover; }

.xp-bar-bg { height:12px; background:#111; border-radius:10px; overflow:hidden; margin-top:8px; }
.xp-bar-fill { height:100%; background:linear-gradient(to right,var(--primary),var(--accent)); width:0%; transition:1.5s; }

.menu-nav { display:flex; flex-direction:column; gap:8px; }
.menu-link { padding:14px 18px; border-radius:12px; color:#aaa; text-decoration:none; cursor:pointer; display:flex; align-items:center; gap:12px; transition:0.3s; }
.menu-link:hover, .menu-link.active { background: rgba(0,255,127,0.1); color: var(--primary); }

.section-view { display:none; }
.section-view.active { display:block; animation:fadeIn 0.5s ease; }

@keyframes fadeIn { from{opacity:0;} to{opacity:1;} }

.top-legends-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:15px; margin:20px 0; }
.legend-card { background: rgba(0,0,0,0.4); border-radius:15px; padding:15px; text-align:center; border-top:3px solid #333; }

.tour-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(250px,1fr)); gap:20px; margin-top:15px; }
.tour-item { background:#080808; border-radius:15px; border:1px solid var(--border); overflow:hidden; transition:0.3s; padding:15px; }
.tour-item:hover { border-color:var(--primary); box-shadow:0 8px 25px rgba(0,255,127,0.2); }

.btn-join { background:linear-gradient(135deg,var(--primary),var(--accent)); padding:12px; border:none; border-radius:12px; cursor:pointer; color:#000; font-weight:900; width:100%; margin-top:10px; transition:0.3s; }
.btn-join:hover { transform:scale(1.05); }

.ad-board { background: rgba(0,0,0,0.7); border-radius:15px; padding:15px; overflow:hidden; margin-bottom:20px; position:relative; height:150px; }
.ad-slide { position:absolute; width:100%; height:100%; top:0; left:0; display:flex; justify-content:center; align-items:center; font-weight:900; font-size:18px; color:#fff; transition:0.5s; opacity:0; }
.ad-slide.active { opacity:1; }

.chat-box { height:300px; overflow-y:auto; padding:10px; display:flex; flex-direction:column-reverse; }
.chat-input { display:flex; gap:8px; margin-top:10px; }
.chat-input input { flex:1; padding:8px; border-radius:8px; border:1px solid #222; background:#000; color:#fff; }
.chat-input button { padding:8px 12px; border-radius:8px; border:none; background:var(--primary); color:#000; cursor:pointer; }

</style>
</head>
<body>

<div id="bg-field"></div>

<nav>
    <div class="logo">PES<span>ELITE</span></div>
    <div class="user-info">
        <div class="rating" id="navRating">1000</div>
        <img id="navUserImg" src="https://via.placeholder.com/50">
    </div>
</nav>

<div class="app-container">
    <!-- Sidebar -->
    <aside>
        <div class="glass-panel text-center">
            <div class="avatar-ring"><img id="myAvatar" src="https://via.placeholder.com/130"></div>
            <h2 id="myName">ØªØ­Ù…ÙŠÙ„...</h2>
            <div id="myID" style="font-family:'Orbitron'; color:var(--primary)">#000000</div>
            <div class="xp-bar-bg"><div class="xp-bar-fill" id="xpFill"></div></div>
            <div style="margin-top:5px; font-size:12px;" id="myXP">0/1000 XP</div>
        </div>

        <div class="glass-panel">
            <div class="menu-nav">
                <div class="menu-link active" onclick="tab('dash', this)"><i class="fas fa-th-large"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
                <div class="menu-link" onclick="tab('tours', this)"><i class="fas fa-trophy"></i> Ø§Ù„Ø¨Ø·ÙˆÙ„Ø§Øª</div>
                <div class="menu-link" onclick="tab('acc', this)"><i class="fas fa-user-cog"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
                <div class="menu-link" style="color:#ff4d4d;" onclick="auth.signOut()"><i class="fas fa-sign-out-alt"></i> Ø®Ø±ÙˆØ¬</div>
            </div>
        </div>
    </aside>

    <!-- Main -->
    <main>
        <section id="dash-sec" class="section-view active">
            <h2>ğŸ† Ø£Ø³Ø§Ø·ÙŠØ± Ø§Ù„Ø´Ù‡Ø±</h2>
            <div class="top-legends-grid" id="topGrid"></div>

            <div class="ad-board" id="adBoard">
                <div class="ad-slide active">Ù…Ø±Ø­Ø¨Ø§ Ø¨Ùƒ ÙÙŠ PES ELITE! ØªØ§Ø¨Ø¹ Ø¢Ø®Ø± Ø§Ù„Ø¨Ø·ÙˆÙ„Ø§Øª</div>
                <div class="ad-slide">Ø§Ù†Ø¶Ù… Ø§Ù„Ø¢Ù† Ù„Ù„ÙÙˆØ² Ø¨Ø¬ÙˆØ§Ø¦Ø² Ù…Ø°Ù‡Ù„Ø©!</div>
                <div class="ad-slide">ØªØ­Ø¯ÙŠØ§Øª Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© ÙˆØ¬ÙˆØ§Ø¦Ø² Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</div>
            </div>

            <h3>Ø§Ù„Ø¨Ø·ÙˆÙ„Ø§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø©</h3>
            <div id="homeTourGrid" class="tour-grid"></div>
        </section>

        <section id="tours-sec" class="section-view">
            <h2>Ù…Ø±ÙƒØ² Ø§Ù„Ø¨Ø·ÙˆÙ„Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„</h2>
            <div id="fullTourGrid" class="tour-grid"></div>
        </section>

        <section id="acc-sec" class="section-view">
            <h2>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</h2>
            <div class="glass-panel">
                <input type="text" id="editName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯" style="width:100%; padding:12px; background:#000; border:1px solid #222; border-radius:10px; color:#fff; margin-bottom:10px;">
                <button class="btn-join" onclick="updateProfile()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù</button>
            </div>
        </section>
    </main>

    <!-- Right Sidebar -->
    <aside>
        <div class="glass-panel">
            <h3>Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</h3>
            <div class="chat-box" id="globalChat"></div>
            <div class="chat-input">
                <input type="text" id="chatInp" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...">
                <button onclick="sendMsg()"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </aside>
</div>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyCYAtj7gB7bfXPPSRojddCzhIyUMN7Tnow",
    authDomain: "pes-elite.firebaseapp.com",
    projectId: "pes-elite",
    storageBucket: "pes-elite.firebasestorage.app",
    messagingSenderId: "407069539120",
    appId: "1:407069539120:web:466249fa7f716266d9e6f5"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

let uID, userData;

auth.onAuthStateChanged(user=>{
    if(user){ uID=user.uid; syncUser(); }
    else { window.location.href="login.html"; }
});

function syncUser(){
    db.collection("players").doc(uID).onSnapshot(doc=>{
        if(!doc.exists) return;
        userData = doc.data();
        document.getElementById('myName').innerText = userData.nickname || "Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…";
        document.getElementById('myID').innerText = "#" + (userData.playerID||"0000");
        document.getElementById('navRating').innerText = userData.gpPoints||1000;
        if(userData.photoURL){
            document.getElementById('myAvatar').src=userData.photoURL;
            document.getElementById('navUserImg').src=userData.photoURL;
        }
        const xp = userData.xp||0;
        document.getElementById('xpFill').style.width=(xp%1000/10)+"%";
        document.getElementById('myXP').innerText=`${xp%1000}/1000 XP`;
    });
    loadApp();
}

function tab(id,el){
    document.querySelectorAll('.section-view').forEach(s=>s.classList.remove('active'));
    document.getElementById(id+'-sec').classList.add('active');
    document.querySelectorAll('.menu-link').forEach(l=>l.classList.remove('active'));
    el.classList.add('active');
}

// Ø¥Ø¹Ù„Ø§Ù† Ù…ØªØ­Ø±Ùƒ
let adIndex=0;
setInterval(()=>{
    const ads=document.querySelectorAll('.ad-slide');
    ads.forEach(a=>a.classList.remove('active'));
    ads[adIndex].classList.add('active');
    adIndex=(adIndex+1)%ads.length;
},5000);

function loadApp(){
    // Ø§Ù„Ø¨Ø·ÙˆÙ„Ø§Øª
    db.collection("tournaments").onSnapshot(snap=>{
        const h=document.getElementById('homeTourGrid'), f=document.getElementById('fullTourGrid');
        h.innerHTML=f.innerHTML="";
        snap.forEach(doc=>{
            const t=doc.data();
            const card=`<div class="tour-item"><h4>${t.title}</h4><p>Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©: ${t.prize}</p><button class="btn-join" onclick="joinReq('${t.title}')">Ø§Ù†Ø¶Ù…Ø§Ù…</button></div>`;
            h.innerHTML+=card; f.innerHTML+=card;
        });
    });

    // Ø§Ù„Ø´Ø§Øª
    db.collection("global_chat").orderBy("time","desc").limit(20).onSnapshot(snap=>{
        const box=document.getElementById('globalChat'); box.innerHTML="";
        snap.forEach(d=>{
            const m=d.data();
            box.innerHTML+=`<div style="margin-bottom:8px; background:rgba(255,255,255,0.05); padding:8px; border-radius:8px;"><b style="color:var(--primary)">${m.sender}:</b><br>${m.text}</div>`;
        });
    });
}

async function joinReq(tName){
    if(!userData) return;
    if(confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ø¨Ø·ÙˆÙ„Ø©: ${tName}ØŸ`)){
        await db.collection("playerRequests").add({
            uid:uID,
            playerName:userData.nickname,
            playerPhoto:userData.photoURL||"",
            tournamentName:tName,
            status:"pending",
            time:Date.now()
        });
        alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!");
    }
}

async function sendMsg(){
    const inp=document.getElementById('chatInp');
    if(!inp.value.trim()) return;
    await db.collection("global_chat").add({
        sender:userData.nickname,
        text:inp.value,
        time:firebase.firestore.FieldValue.serverTimestamp()
    });
    inp.value="";
}

function updateProfile(){
    const newName=document.getElementById('editName').value.trim();
    if(!newName) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯");
    db.collection("players").doc(uID).update({nickname:newName});
    alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù… Ø¨Ù†Ø¬Ø§Ø­!");
}
</script>
</body>
</html>
