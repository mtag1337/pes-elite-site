<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PES ELITE | DASHBOARD</title>

<!-- Google Fonts & Icons -->
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Orbitron:wght@600;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<style>
:root {
    --primary: #00f2ff;
    --accent: #bc13fe;
    --green: #3cb043;
    --dark-bg: #0a0a0a;
    --panel-bg: rgba(15,15,25,0.95);
    --border: rgba(255,255,255,0.08);
    --gold: #ffcc00;
}

* { margin:0; padding:0; box-sizing:border-box; outline:none; }
body { font-family:'Cairo', sans-serif; background:#0a0a0a; color:#fff; overflow-x:hidden; scroll-behavior:smooth; }

/* Background Stadium */
#stadium-bg {
    position: fixed; top:0; left:0; width:100%; height:100%;
    background: url('https://i.ibb.co/y0fH0J9/football-field.jpg') center/cover no-repeat;
    z-index:-2; filter: brightness(0.4);
}

/* Gradient Overlay */
.overlay {
    position: fixed; top:0; left:0; width:100%; height:100%;
    background: linear-gradient(to top, rgba(0,0,0,0.7), rgba(0,0,0,0.1));
    z-index:-1;
}

/* Navbar */
nav {
    height: 80px; background: var(--panel-bg); display:flex; align-items:center; justify-content:space-between;
    padding: 0 30px; position:sticky; top:0; z-index:1000; border-bottom:2px solid var(--primary);
}
nav .logo { font-family:'Orbitron', sans-serif; font-size:28px; font-weight:900; color:#fff; }
nav .logo span { color: var(--primary); text-shadow: 0 0 15px var(--primary); }
nav .user-panel { display:flex; align-items:center; gap:20px; }
nav .user-panel img { width:55px; height:55px; border-radius:50%; border:2px solid var(--primary); }

/* Layout */
.app-container { display:grid; grid-template-columns:320px 1fr 320px; gap:20px; padding:20px; max-width:1900px; margin:auto; }
.glass-panel { background: var(--panel-bg); border:1px solid var(--border); border-radius:20px; padding:20px; margin-bottom:20px; position:relative; transition:0.3s; }
.glass-panel:hover { box-shadow:0 10px 30px rgba(0,242,255,0.1); border-color: var(--primary); }

/* Avatar */
.avatar-ring { width:140px; height:140px; margin:0 auto 15px; padding:5px; border-radius:50%; background: linear-gradient(45deg,var(--primary),var(--accent)); position:relative; }
.avatar-ring img { width:100%; height:100%; border-radius:50%; border:4px solid var(--dark-bg); object-fit:cover; }
.avatar-ring label { position:absolute; bottom:0; left:0; width:35px; height:35px; border-radius:50%; background:var(--primary); color:#000; display:flex; justify-content:center; align-items:center; cursor:pointer; }

/* XP Bar */
.xp-bar-bg { height:12px; background:#111; border-radius:10px; overflow:hidden; margin-top:8px; }
.xp-bar-fill { height:100%; background: linear-gradient(to right,var(--primary),var(--accent)); width:0%; transition:1.5s; }

/* Menu */
.menu-nav { display:flex; flex-direction:column; gap:10px; }
.menu-link { padding:14px 18px; border-radius:14px; color:#777; text-decoration:none; display:flex; align-items:center; gap:12px; cursor:pointer; transition:0.3s; }
.menu-link:hover, .menu-link.active { background: rgba(0,242,255,0.1); color: var(--primary); }

/* Sections */
.section-view { display:none; }
.section-view.active { display:block; animation: fadeIn 0.5s ease; }
@keyframes fadeIn { from { opacity:0; } to { opacity:1; } }

/* Top Legends */
.top-legends-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:15px; margin:20px 0; }
.legend-card { background:rgba(0,0,0,0.4); border:1px solid rgba(255,255,255,0.05); border-radius:20px; padding:15px; text-align:center; transition:0.3s; }
.legend-card:hover { transform:translateY(-5px); box-shadow:0 5px 20px rgba(0,242,255,0.2); }

/* Tournaments */
.tour-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:20px; }
.tour-item { background:#08080c; border-radius:20px; border:1px solid var(--border); overflow:hidden; transition:0.3s; }
.tour-item:hover { border-color: var(--primary); box-shadow:0 5px 15px rgba(0,242,255,0.1); }
.btn-save { width:100%; padding:12px; background: var(--primary); border:none; border-radius:12px; font-weight:900; cursor:pointer; color:#000; transition:0.3s; }
.btn-save:hover { background: var(--accent); color:#fff; }

/* Chat */
.chat-box { height:350px; overflow-y:auto; padding:10px; display:flex; flex-direction:column-reverse; }

/* League Button */
.btn-league-mega { background: linear-gradient(135deg,#6200ea,#bc13fe); padding:28px; border-radius:28px; text-align:center; cursor:pointer; border:none; width:100%; color:white; margin-bottom:25px; transition:0.3s; }
.btn-league-mega:hover { transform:scale(1.05); box-shadow:0 0 20px var(--primary); }
</style>
</head>

<body>
<div id="stadium-bg"></div>
<div class="overlay"></div>

<nav>
    <div class="logo">PES<span>ELITE</span></div>
    <div class="user-panel">
        <div>
            <div style="font-size:10px; color:#444;">RATING</div>
            <div id="navRating" style="font-family:'Orbitron'; font-size:20px; font-weight:900; color:var(--primary);">1000</div>
        </div>
        <img id="navUserImg" src="https://via.placeholder.com/55">
    </div>
</nav>

<div class="app-container">
<aside>
    <div class="glass-panel text-center">
        <div class="avatar-ring">
            <img id="myAvatar" src="https://via.placeholder.com/140">
            <label for="imgFile"><i class="fas fa-camera"></i></label>
            <input type="file" id="imgFile" style="display:none" onchange="handleImg(this)">
        </div>
        <h2 id="myName">تحميل...</h2>
        <div id="myID" style="color:var(--primary); font-family:'Orbitron';">#00000000</div>
        <div style="margin-top:10px;">
            <span>LEVEL <b id="myLvl">1</b></span>
            <span id="myXP" style="float:left;">0/1000 XP</span>
        </div>
        <div class="xp-bar-bg"><div id="xpFill" class="xp-bar-fill"></div></div>
    </div>

    <div class="glass-panel">
        <div class="menu-nav">
            <div class="menu-link active" onclick="tab('dash',this)"><i class="fas fa-th-large"></i> لوحة التحكم</div>
            <div class="menu-link" onclick="tab('tours',this)"><i class="fas fa-trophy"></i> مركز البطولات</div>
            <div class="menu-link" onclick="tab('acc',this)"><i class="fas fa-user-cog"></i> الإعدادات</div>
            <div class="menu-link" style="color:#ff4d4d;" onclick="auth.signOut()"><i class="fas fa-sign-out-alt"></i> خروج</div>
        </div>
    </div>
</aside>

<main>
<section id="dash-sec" class="section-view active">
    <h2><i class="fas fa-crown" style="color:var(--gold)"></i> أساطير الشهر</h2>
    <div id="topGrid" class="top-legends-grid"></div>

    <div class="glass-panel">
        <h3>لوحة الإعلانات</h3>
        <marquee id="adsBoard" scrollamount="5" style="color:var(--primary); font-weight:900;">أهلاً بكم في PES ELITE - البطولات الآن مفتوحة!</marquee>
    </div>

    <h3><i class="fas fa-bolt" style="color:var(--gold)"></i> البطولات المفتوحة</h3>
    <div id="homeTourGrid" class="tour-grid"></div>
</section>

<section id="tours-sec" class="section-view">
    <h2>مركز البطولات الكامل</h2>
    <div id="fullTourGrid" class="tour-grid"></div>
</section>

<section id="acc-sec" class="section-view">
    <h2>إعدادات الحساب</h2>
    <div class="glass-panel">
        <input type="text" id="editName" placeholder="الاسم الجديد" style="width:100%; padding:12px; background:#000; border:1px solid #222; border-radius:12px; color:#fff; margin-bottom:10px;">
        <button class="btn-save" onclick="updateProfile()">تحديث الملف</button>
    </div>
</section>
</main>

<aside>
    <button class="btn-league-mega" onclick="window.location.href='league.html'">
        <i class="fas fa-shield-halved" style="font-size:40px;"></i>
        <h3>LEAGUE HUB</h3>
    </button>
    <div class="glass-panel">
        <h3>الدردشة العامة</h3>
        <div id="globalChat" class="chat-box"></div>
        <div style="display:flex; gap:5px; margin-top:10px;">
            <input type="text" id="chatInp" placeholder="اكتب رسالة..." style="flex:1; background:#000; border:1px solid #222; color:white; border-radius:8px; padding:8px;">
            <button onclick="sendMsg()" style="background:var(--primary); border:none; padding:8px 12px; border-radius:8px;"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>
</aside>
</div>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyCYAtj7gB7bfXPPSRojddCzhIyUMN7Tnow",
    authDomain: "pes-elite.firebaseapp.com",
    projectId: "pes-elite",
    storageBucket: "pes-elite.firebasestorage.app",
    messagingSenderId: "407069539120",
    appId: "1:407069539120:web:466249fa7f716266d9e6f5"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

let uID, userData;

auth.onAuthStateChanged(user=>{
    if(user){ uID = user.uid; syncUser(); } 
    else{ window.location.href="login.html"; }
});

function syncUser(){
    db.collection("players").doc(uID).onSnapshot(doc=>{
        if(!doc.exists) return;
        userData = doc.data();
        document.getElementById('myName').innerText = userData.nickname||"بدون اسم";
        document.getElementById('myID').innerText = "#" + (userData.playerID||"0000");
        document.getElementById('navRating').innerText = userData.gpPoints||1000;
        if(userData.photoURL){
            document.getElementById('myAvatar').src = userData.photoURL;
            document.getElementById('navUserImg').src = userData.photoURL;
        }
        const xp = userData.xp||0;
        document.getElementById('myLvl').innerText = Math.floor(xp/1000)+1;
        document.getElementById('xpFill').style.width = (xp%1000/10) + "%";
        document.getElementById('myXP').innerText = `${xp%1000}/1000 XP`;
    });
    loadApp();
}

function loadApp(){
    // البطولات
    db.collection("tournaments").onSnapshot(snap=>{
        const h = document.getElementById('homeTourGrid'), f = document.getElementById('fullTourGrid');
        h.innerHTML=f.innerHTML="";
        snap.forEach(doc=>{
            const t = doc.data();
            const card=`<div class="tour-item"><div style="padding:15px;"><h4>${t.title}</h4><p style="font-size:11px;color:#777">الجائزة: ${t.prize}</p><button class="btn-save" style="margin-top:10px" onclick="joinReq('${t.title}')">انضمام</button></div></div>`;
            f.innerHTML+=card; h.innerHTML+=card;
        });
    });

    // التوب 3
    db.collection("topPlayers").orderBy("xp","desc").limit(3).onSnapshot(snap=>{
        const g = document.getElementById('topGrid'); g.innerHTML="";
        snap.forEach(d=>{
            const u = d.data();
            g.innerHTML+=`<div class="legend-card"><img src="${u.photoURL||'https://via.placeholder.com/80'}" style="width:80px; height:80px; border-radius:50%; margin-bottom:10px;"><h4>${u.nickname}</h4><p>LEVEL ${Math.floor((u.xp||0)/1000)+1}</p></div>`;
        });
    });

    // الشات
    db.collection("global_chat").orderBy("time","desc").limit(20).onSnapshot(snap=>{
        const box = document.getElementById('globalChat'); box.innerHTML="";
        snap.forEach(d=>{
            const m=d.data();
            box.innerHTML+=`<div style="margin-bottom:8px; background:rgba(255,255,255,0.03); padding:8px; border-radius:8px;"><b style="color:var(--primary)">${m.sender}:</b><br>${m.text}</div>`;
        });
    });
}

async function sendMsg(){
    const inp=document.getElementById('chatInp');
    if(!inp.value.trim()) return;
    await db.collection("global_chat").add({sender:userData.nickname, text:inp.value, time:firebase.firestore.FieldValue.serverTimestamp()});
    inp.value="";
}

function liveSearch(val){
    if(val.length<2){ document.getElementById('searchRes').innerHTML=""; return; }
    db.collection("players").where("nickname",">=",val).limit(5).get().then(snap=>{
        let h=''; snap.forEach(d=>{ h+=`<div class="glass-panel" style="padding:10px; margin-bottom:5px;">${d.data().nickname} - LVL: ${Math.floor((d.data().xp||0)/1000)+1}</div>`; });
        document.getElementById('searchRes').innerHTML=h;
    });
}

function tab(id,el){
    document.querySelectorAll('.section-view').forEach(s=>s.classList.remove('active'));
    document.getElementById(id+'-sec').classList.add('active');
    document.querySelectorAll('.menu-link').forEach(l=>l.classList.remove('active'));
    el.classList.add('active');
}

function handleImg(input){
    if(input.files && input.files[0]){
        const reader = new FileReader();
        reader.onload = e=>{ document.getElementById('myAvatar').src=e.target.result; document.getElementById('navUserImg').src=e.target.result; };
        reader.readAsDataURL(input.files[0]);
    }
}

function updateProfile(){
    const newName=document.getElementById('editName').value.trim();
    if(!newName) return alert("اكتب اسم جديد!");
    db.collection("players").doc(uID).update({nickname:newName}).then(()=>alert("تم تحديث الاسم!"));
}

async function joinReq(tName){
    if(!userData) return;
    if(confirm(`هل تريد الانضمام لبطولة: ${tName}؟`)){
        await db.collection("playerRequests").add({uid:uID, playerName:userData.nickname, playerPhoto:userData.photoURL||"", tournamentName:tName, status:"pending", time:Date.now()});
        alert("تم إرسال طلبك بنجاح!");
    }
}
</script>
</body>
</html>
