<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PES ELITE | DASHBOARD</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Orbitron:wght@600;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
    --green: #1b5e20;
    --dark: #0b0b0b;
    --white: #ffffff;
    --blue: #00f2ff;
    --accent: #bc13fe;
    --panel: rgba(15, 15, 25, 0.95);
    --border: rgba(255,255,255,0.08);
    --gold: #ffcc00;
}

* {margin:0;padding:0;box-sizing:border-box;font-family:'Cairo',sans-serif;}
body {overflow-x:hidden;color:white;}

/* NAV */
nav{
    height:80px;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:space-between;padding:0 30px;
    border-bottom:2px solid var(--green);position:sticky;top:0;z-index:1000;
}
.logo{font-family:'Orbitron',sans-serif;font-size:30px;font-weight:900;}
.logo span{color:var(--green);text-shadow:0 0 15px var(--green);}
.nav-user{display:flex;align-items:center;gap:20px;}
.nav-user img{width:55px;height:55px;border-radius:50%;border:2px solid var(--green);}

/* MAIN GRID */
.app-container{display:grid;grid-template-columns:350px 1fr 350px;gap:20px;padding:20px;max-width:1800px;margin:auto;}

/* GLASS PANELS */
.glass-panel{background:var(--panel);border:1px solid var(--border);border-radius:25px;padding:25px;margin-bottom:20px;position:relative;overflow:hidden;transition:0.3s;}
.glass-panel:hover{border-color:var(--green);box-shadow:0 10px 40px rgba(0,242,255,0.1);}

/* AVATAR */
.avatar-ring{width:140px;height:140px;margin:0 auto 15px;padding:5px;border-radius:50%;background:linear-gradient(45deg,var(--green),var(--accent));position:relative;}
.avatar-ring img{width:100%;height:100%;border-radius:50%;object-fit:cover;border:4px solid var(--dark);}
.xp-bar-bg{height:12px;background:#111;border-radius:10px;overflow:hidden;margin-top:8px;}
.xp-bar-fill{height:100%;background:linear-gradient(to right,var(--green),var(--accent));width:0%;transition:1.5s;}

/* MENU */
.menu-nav{display:flex;flex-direction:column;gap:10px;margin-top:20px;}
.menu-link{padding:16px 22px;border-radius:16px;color:#ccc;text-decoration:none;cursor:pointer;display:flex;align-items:center;gap:18px;transition:0.3s;}
.menu-link:hover,.menu-link.active{background:rgba(0,242,255,0.1);color:var(--green);}

/* SECTIONS */
.top-legends-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin-top:15px;}
.legend-card{background:rgba(0,0,0,0.4);border:1px solid rgba(255,255,255,0.05);padding:20px 10px;border-radius:20px;text-align:center;border-top:3px solid #333;}
.tour-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px;}
.tour-item{background:#08080c;border-radius:20px;border:1px solid var(--border);overflow:hidden;transition:0.3s;padding:15px;}
.tour-item h4{margin-bottom:5px;}
.tour-item button{margin-top:10px;background:var(--green);color:#000;border:none;padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:900;transition:0.3s;}
.tour-item button:hover{background:var(--accent);color:white;}

/* CHAT */
.chat-box{height:350px;overflow-y:auto;padding:10px;display:flex;flex-direction:column-reverse;background:rgba(0,0,0,0.3);border-radius:12px;}
.chat-box div{margin-bottom:8px;padding:8px;border-radius:8px;background:rgba(255,255,255,0.05);}
.chat-input{display:flex;gap:5px;margin-top:10px;}
.chat-input input{flex:1;padding:10px;border-radius:8px;border:1px solid #222;background:#000;color:white;}
.chat-input button{padding:10px 12px;border:none;border-radius:8px;background:var(--green);cursor:pointer;color:#000;}

/* OTHER */
.section-view{display:none;}
.section-view.active{display:block;animation:fadeIn 0.5s ease;}
@keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
.btn-save{width:100%;padding:12px;background:var(--green);border:none;border-radius:12px;font-weight:900;cursor:pointer;color:#000;transition:0.3s;}
.btn-save:hover{background:var(--accent);color:white;}
.announcement{background:rgba(0,0,0,0.6);padding:15px;margin-bottom:20px;border-radius:15px;border:1px solid rgba(255,255,255,0.1);}
</style>
</head>
<body>

<canvas id="bgCanvas" style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;"></canvas>

<nav>
    <div class="logo">PES<span>ELITE</span></div>
    <div class="nav-user">
        <div style="text-align:center;">
            <div style="font-size:10px;color:#444;">RATING</div>
            <div id="navRating" style="font-family:'Orbitron';color:var(--green);font-size:20px;font-weight:900;">1000</div>
        </div>
        <img id="navUserImg" src="https://via.placeholder.com/55">
    </div>
</nav>

<div class="app-container">
<!-- LEFT PANEL -->
<aside>
    <div class="glass-panel" style="text-align:center;">
        <div class="avatar-ring">
            <img id="myAvatar" src="https://via.placeholder.com/140">
            <label for="imgFile" style="position:absolute;bottom:0;left:10px;background:var(--green);color:#000;width:35px;height:35px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;"><i class="fas fa-camera"></i></label>
            <input type="file" id="imgFile" style="display:none" onchange="handleImg(this)">
        </div>
        <h2 id="myName">ØªØ­Ù…ÙŠÙ„...</h2>
        <div id="myID" style="color:var(--green);font-family:'Orbitron';">#00000000</div>
        <div class="xp-bar-wrap">
            <div style="display:flex;justify-content:space-between;font-size:11px;">
                <span>LEVEL <b id="myLvl">1</b></span>
                <span id="myXP">0/1000 XP</span>
            </div>
            <div class="xp-bar-bg"><div class="xp-bar-fill" id="xpFill"></div></div>
        </div>
    </div>

    <div class="glass-panel">
        <div class="menu-nav">
            <div class="menu-link active" onclick="tab('dash', this)"><i class="fas fa-th-large"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
            <div class="menu-link" onclick="tab('tours', this)"><i class="fas fa-trophy"></i> Ù…Ø±ÙƒØ² Ø§Ù„Ø¨Ø·ÙˆÙ„Ø§Øª</div>
            <div class="menu-link" onclick="tab('acc', this)"><i class="fas fa-user-cog"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
            <div class="menu-link" style="color:#ff4d4d;" onclick="auth.signOut()"><i class="fas fa-sign-out-alt"></i> Ø®Ø±ÙˆØ¬</div>
        </div>
    </div>
</aside>

<!-- MAIN -->
<main>
<section id="dash-sec" class="section-view active">
    <div class="announcement" id="announcementArea">
        <h3>ğŸ“¢ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</h3>
        <p id="annText">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…ÙˆÙ‚Ø¹ PES ELITE! Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ù‡Ù†Ø§ Ø¨Ø´ÙƒÙ„ Ø£Ø³Ø¨ÙˆØ¹ÙŠ.</p>
    </div>

    <h2><i class="fas fa-crown" style="color:var(--gold)"></i> Ø£Ø³Ø§Ø·ÙŠØ± Ø§Ù„Ø´Ù‡Ø±</h2>
    <div class="top-legends-grid" id="topGrid"></div>

    <h3><i class="fas fa-bolt" style="color:var(--gold)"></i> Ø§Ù„Ø¨Ø·ÙˆÙ„Ø§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø©</h3>
    <div id="homeTourGrid" class="tour-grid"></div>
</section>

<section id="tours-sec" class="section-view">
    <h2>Ù…Ø±ÙƒØ² Ø§Ù„Ø¨Ø·ÙˆÙ„Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„</h2>
    <div id="fullTourGrid" class="tour-grid" style="margin-top:20px;"></div>
</section>

<section id="acc-sec" class="section-view">
    <h2>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</h2>
    <div class="glass-panel" style="margin-top:20px;">
        <input type="text" id="editName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯" style="width:100%;padding:14px;background:#000;border:1px solid #222;border-radius:12px;color:#fff;margin-bottom:15px;">
        <button class="btn-save" onclick="updateProfile()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù</button>
    </div>
</section>
</main>

<!-- RIGHT PANEL -->
<aside>
    <button class="btn-save" onclick="window.location.href='league.html'" style="margin-bottom:20px;"><i class="fas fa-shield-halved" style="font-size:35px"></i> LEAGUE HUB</button>
    <div class="glass-panel">
        <h3>Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</h3>
        <div class="chat-box" id="globalChat"></div>
        <div class="chat-input">
            <input type="text" id="chatInp" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...">
            <button onclick="sendMsg()"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>
</aside>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script>
// Firebase
const firebaseConfig = { apiKey:"AIzaSyCYAtj7gB7bfXPPSRojddCzhIyUMN7Tnow", authDomain:"pes-elite.firebaseapp.com", projectId:"pes-elite", storageBucket:"pes-elite.firebasestorage.app", messagingSenderId:"407069539120", appId:"1:407069539120:web:466249fa7f716266d9e6f5" };
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

let uID,userData;
auth.onAuthStateChanged(user=>{ if(user){ uID=user.uid; syncUser(); } else{ window.location.href="login.html"; } });

function syncUser(){
    db.collection("players").doc(uID).onSnapshot(doc=>{
        if(!doc.exists) return;
        userData=doc.data();
        document.getElementById('myName').innerText=userData.nickname||"Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…";
        document.getElementById('myID').innerText="#"+(userData.playerID||"0000");
        document.getElementById('navRating').innerText=userData.gpPoints||1000;
        if(userData.photoURL){document.getElementById('myAvatar').src=userData.photoURL;document.getElementById('navUserImg').src=userData.photoURL;}
        const xp=userData.xp||0;
        document.getElementById('myLvl').innerText=Math.floor(xp/1000)+1;
        document.getElementById('xpFill').style.width=(xp%1000/10)+"%";
        document.getElementById('myXP').innerText=`${xp%1000}/1000 XP`;
    });
    loadApp();
}

function joinReq(tName){if(!userData) return; if(confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ø¨Ø·ÙˆÙ„Ø©: ${tName}?`)){ db.collection("playerRequests").add({uid:uID,playerName:userData.nickname,playerPhoto:userData.photoURL||"",tournamentName:tName,status:"pending",time:Date.now()}); alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!");}}

function handleImg(input){const file=input.files[0]; if(!file) return; const reader=new FileReader(); reader.onload=function(e){ document.getElementById('myAvatar').src=e.target.result; document.getElementById('navUserImg').src=e.target.result; } reader.readAsDataURL(file);}

function updateProfile(){const newName=document.getElementById('editName').value.trim(); if(!newName) return alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯!"); db.collection("players").doc(uID).update({nickname:newName}); alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù…!");}

function loadApp(){
    db.collection("tournaments").onSnapshot(snap=>{
        const h=document.getElementById('homeTourGrid'), f=document.getElementById('fullTourGrid');
        h.innerHTML=f.innerHTML="";
        snap.forEach(doc=>{
            const t=doc.data();
            const card=`<div class="tour-item"><h4>${t.title}</h4><p style="font-size:11px;color:#ccc;">Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©: ${t.prize}</p><button onclick="joinReq('${t.title}')">Ø§Ù†Ø¶Ù…Ø§Ù…</button></div>`;
            h.innerHTML+=card; f.innerHTML+=card;
        });
    });

    db.collection("players").orderBy("gpPoints","desc").limit(3).onSnapshot(snap=>{
        const topGrid=document.getElementById('topGrid'); topGrid.innerHTML="";
        snap.forEach(d=>{
            const data=d.data();
            topGrid.innerHTML+=`<div class="legend-card"><h4>${data.nickname}</h4><p>Ù†Ù‚Ø§Ø·: ${data.gpPoints||0}</p></div>`;
        });
    });

    db.collection("global_chat").orderBy("time","desc").limit(20).onSnapshot(snap=>{
        const box=document.getElementById('globalChat'); box.innerHTML="";
        snap.forEach(d=>{const m=d.data(); box.innerHTML+=`<div><b style="color:var(--green)">${m.sender}:</b><br>${m.text}</div>`;});
    });
}

function sendMsg(){const inp=document.getElementById('chatInp'); if(!inp.value.trim()) return; db.collection("global_chat").add({sender:userData.nickname,text:inp.value,time:firebase.firestore.FieldValue.serverTimestamp()}); inp.value="";}

function tab(id,el){document.querySelectorAll('.section-view').forEach(s=>s.classList.remove('active')); document.getElementById(id+'-sec').classList.add('active'); document.querySelectorAll('.menu-link').forEach(l=>l.classList.remove('active')); el.classList.add('active');}
</script>

<script>
// BACKGROUND ANIMATION - Ø§Ù„Ù…Ù„Ø¹Ø¨
const bgCanvas = document.getElementById('bgCanvas');
const ctx = bgCanvas.getContext('2d');
let width = bgCanvas.width = window.innerWidth;
let height = bgCanvas.height = window.innerHeight;

// Ù…ØªØºÙŠØ±Ø§Øª Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ù„Ø¹Ø¨
let lines = [];
for(let i=0;i<50;i++){
  lines.push({x: Math.random()*width, y: Math.random()*height, length: 100+Math.random()*200, speed:0.3+Math.random()*0.5, color:i%2===0?"#fff":"#1b5e20"});
}

// Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠØ© ØªØªØ­Ø±Ùƒ Ø®ÙÙŠÙ (Ø¯ÙŠÙƒÙˆØ±)
let ball = {x:width/2,y:height/2,r:20,dx:2,dy:1.5,color:"#ffd700"};

function drawField(){
    // Ø£Ø±Ø¶ÙŠØ©
    ctx.fillStyle = "#1b5e20";
    ctx.fillRect(0,0,width,height);

    // Ø®Ø·ÙˆØ· Ø¨ÙŠØ¶Ø§Ø¡
    ctx.strokeStyle="#ffffff";
    ctx.lineWidth=4;
    // Ø®Ø· Ø§Ù„Ù…Ù†ØªØµÙ
    ctx.beginPath();
    ctx.moveTo(width/2,0);
    ctx.lineTo(width/2,height);
    ctx.stroke();
    // Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ù…Ù†ØªØµÙ
    ctx.beginPath();
    ctx.arc(width/2,height/2,70,0,Math.PI*2);
    ctx.stroke();

    // Ø§Ù„Ù…Ø±Ù…Ù‰
    ctx.strokeStyle="#ccc";
    ctx.lineWidth=3;
    ctx.strokeRect(50,height/2-50,10,100);
    ctx.strokeRect(width-60,height/2-50,10,100);

    // Ø®Ø·ÙˆØ· Ù…ØªØ­Ø±ÙƒØ©
    lines.forEach(l=>{
        ctx.beginPath();
        ctx.strokeStyle=l.color;
        ctx.lineWidth=2;
        ctx.moveTo(l.x,l.y);
        ctx.lineTo(l.x,l.y+l.length);
        ctx.stroke();
        l.y-=l.speed;
        if(l.y+l.length<0){l.y
