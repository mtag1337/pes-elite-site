<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>PES ELITE | ADMIN FINAL</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <style>
        body { background: #050508; color: white; font-family: sans-serif; text-align: center; padding: 20px; }
        .card { background: #12121a; border: 1px solid #eaff00; padding: 20px; border-radius: 15px; max-width: 500px; margin: auto; }
        input, select { width: 90%; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .btn { width: 90%; padding: 12px; background: #eaff00; color: #000; border: none; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>
    <div id="auth-gate" class="card">
        <h2>ğŸ”’ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†</h2>
        <button class="btn" onclick="login()">Ø¯Ø®ÙˆÙ„ Ø¨ÙˆØ§Ø³Ø·Ø© Google</button>
        <div id="pass-area" style="display:none; margin-top:15px;">
            <input type="password" id="sk" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
            <button class="btn" onclick="openPanel()">ÙØªØ­ Ø§Ù„Ù„ÙˆØ­Ø©</button>
        </div>
    </div>

    <div id="panel" style="display:none;">
        <div class="card">
            <h2>âš½ ØªØ³Ø¬ÙŠÙ„ Ù…Ø§ØªØ´</h2>
            <select id="t1"></select> <select id="t2"></select>
            <input type="number" id="s1" placeholder="Ø£Ù‡Ø¯Ø§Ù 1"> <input type="number" id="s2" placeholder="Ø£Ù‡Ø¯Ø§Ù 2">
            <button class="btn" onclick="addMatch()">Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© âœ…</button>
        </div>
        <div class="card" style="margin-top:20px;">
            <h2>ğŸ“ ØªØ¹Ø¯ÙŠÙ„ Ø£Ø³Ù…Ø§Ø¡</h2>
            <select id="editList"></select>
            <input type="text" id="newName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯">
            <button class="btn" onclick="rename()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù… ğŸ”„</button>
        </div>
        <button onclick="resetLeague()" style="background:red; color:white; margin-top:30px; padding:10px;">ğŸš¨ ØªØµÙÙŠØ± Ø§Ù„Ø¯ÙˆØ±ÙŠ (15 Ù„Ø§Ø¹Ø¨)</button>
    </div>

<script>
    const config = { apiKey: "AIzaSyCYAtj7gB7bfXPPSRojddCzhIyUMN7Tnow", authDomain: "pes-elite.firebaseapp.com", projectId: "pes-elite", storageBucket: "pes-elite.firebasestorage.app", messagingSenderId: "407069539120", appId: "1:407069539120:web:466249fa7f716266d9e6f5" };
    firebase.initializeApp(config);
    const db = firebase.firestore(); const auth = firebase.auth();

    function login() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
    function openPanel() { if(document.getElementById('sk').value === "123456") { document.getElementById('auth-gate').style.display='none'; document.getElementById('panel').style.display='block'; load(); } }
    
    auth.onAuthStateChanged(u => { if(u && u.email === "mtag1337@gmail.com") document.getElementById('pass-area').style.display='block'; });

    function load() {
        db.collection("leaguePlayers").orderBy("id").onSnapshot(s => {
            let h = '<option value="">Ø§Ø®ØªØ±..</option>'; s.forEach(d => h+=`<option value="${d.id}">${d.data().name}</option>`);
            document.getElementById('t1').innerHTML=h; document.getElementById('t2').innerHTML=h; document.getElementById('editList').innerHTML=h;
        });
    }

    async function addMatch() {
        const i1=document.getElementById('t1').value, i2=document.getElementById('t2').value, g1=parseInt(document.getElementById('s1').value), g2=parseInt(document.getElementById('s2').value);
        if(!i1 || !i2 || isNaN(g1)) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        await db.collection("leagueMatches").add({t1:i1, t2:i2, s1:g1, s2:g2, time:Date.now()});
        await up(i1, g1, g2); await up(i2, g2, g1); alert("ØªÙ… Ø§Ù„Ø­ÙØ¸!");
    }

    async function up(id, gf, ga) {
        const r=db.collection("leaguePlayers").doc(id), d=(await r.get()).data();
        let w=gf>ga?1:0, dr=gf===ga?1:0;
        await r.update({ played:(d.played||0)+1, pts:(d.pts||0)+(w*3+dr), gd:(d.gd||0)+(gf-ga) });
    }

    async function rename() { await db.collection("leaguePlayers").doc(document.getElementById('editList').value).update({name:document.getElementById('newName').value}); alert("ØªÙ…!"); }

    async function resetLeague() {
        if(!confirm("ØªØµÙÙŠØ±ØŸ")) return;
        for(let i=1; i<=15; i++) await db.collection("leaguePlayers").doc("p"+i).set({id:i, name:"Ù„Ø§Ø¹Ø¨ "+i, played:0, pts:0, gd:0});
        alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ 15 Ù„Ø§Ø¹Ø¨!");
    }
</script>
</body>
</html>
