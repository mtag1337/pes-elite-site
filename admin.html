<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… PES ELITE</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --p: #eaff00; --bg: #050508; --card: #111118; }
        body { background: var(--bg); color: white; font-family: 'Cairo'; margin: 0; padding: 10px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; }
        .card { background: var(--card); padding: 15px; border-radius: 12px; border: 1px solid #222; }
        h2 { color: var(--p); font-size: 1.1rem; border-bottom: 1px solid #333; padding-bottom: 8px; }
        input, select, button { width: 100%; padding: 10px; margin: 5px 0; border-radius: 6px; border: 1px solid #333; background: #000; color: #fff; box-sizing: border-box; }
        button { background: var(--p); color: #000; font-weight: bold; cursor: pointer; border: none; }
        button:hover { opacity: 0.8; }
        .btn-setup { background: #444; color: #fff; font-size: 0.8rem; }
    </style>
</head>
<body>

<h2 style="text-align: center;">âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</h2>

<div class="grid">
    <div class="card">
        <h2>âš½ ØªØ³Ø¬ÙŠÙ„ Ù…ÙˆØ§Ø¬Ù‡Ø© Ù…Ø¨Ø§Ø´Ø±Ø©</h2>
        <select id="m1"><option value="">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„</option></select>
        <select id="m2"><option value="">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ</option></select>
        <div style="display: flex; gap: 5px;">
            <input type="number" id="s1" placeholder="Ø£Ù‡Ø¯Ø§Ù 1">
            <input type="number" id="s2" placeholder="Ø£Ù‡Ø¯Ø§Ù 2">
        </div>
        <button onclick="recordMatch()">Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯ÙˆØ±ÙŠ</button>
    </div>

    <div class="card">
        <h2>ğŸ–¼ï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù…/Ù„ÙˆØ¬Ùˆ Ø§Ù„ÙØ±ÙŠÙ‚</h2>
        <select id="editTeam"><option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ±ÙŠÙ‚</option></select>
        <input type="text" id="newName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯">
        <input type="text" id="newImg" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©">
        <button style="background: white;" onclick="updateInfo()">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    </div>

    <div class="card">
        <h2>ğŸ› ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
        <button class="btn-setup" onclick="setup()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù€ 15 ÙØ±ÙŠÙ‚ Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©</button>
        <p style="font-size: 0.7rem; color: #666;">* Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„Ø¯ÙˆØ±ÙŠ.</p>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCYAtj7gB7bfXPPSRojddCzhIyUMN7Tnow",
        authDomain: "pes-elite.firebaseapp.com",
        projectId: "pes-elite",
        storageBucket: "pes-elite.firebasestorage.app",
        messagingSenderId: "407069539120",
        appId: "1:407069539120:web:466249fa7f716266d9e6f5"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ±Ù‚ ÙÙŠ ÙƒÙ„ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
    function load() {
        db.collection("leaguePlayers").orderBy("order").onSnapshot(snap => {
            let options = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ±ÙŠÙ‚...</option>';
            snap.forEach(doc => { options += `<option value="${doc.id}">${doc.data().nickname}</option>`; });
            document.getElementById('m1').innerHTML = options;
            document.getElementById('m2').innerHTML = options;
            document.getElementById('editTeam').innerHTML = options;
        });
    }

    async function recordMatch() {
        const id1 = document.getElementById('m1').value, id2 = document.getElementById('m2').value;
        const sc1 = parseInt(document.getElementById('s1').value), sc2 = parseInt(document.getElementById('s2').value);
        if(!id1 || !id2 || isNaN(sc1)) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

        const n1 = document.querySelector(`#m1 option[value="${id1}"]`).text;
        const n2 = document.querySelector(`#m2 option[value="${id2}"]`).text;

        await db.collection("matchesHistory").add({ team1: n1, team2: n2, score1: sc1, score2: sc2, time: Date.now() });
        await updateStats(id1, sc1, sc2);
        await updateStats(id2, sc2, sc1);
        alert("ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„!");
    }

    async function updateStats(id, gf, ga) {
        const ref = db.collection("leaguePlayers").doc(id);
        const d = (await ref.get()).data();
        let w = gf > ga ? 1 : 0, dr = gf === ga ? 1 : 0, l = gf < ga ? 1 : 0;
        await ref.update({
            played: (d.played || 0) + 1,
            w: (d.w || 0) + w, d: (d.d || 0) + dr, l: (d.l || 0) + l,
            gf: (d.gf || 0) + gf, ga: (d.ga || 0) + ga,
            pts: ((d.w || 0) + w) * 3 + ((d.d || 0) + dr),
            gd: ((d.gf || 0) + gf) - ((d.ga || 0) + ga)
        });
    }

    async function updateInfo() {
        const id = document.getElementById('editTeam').value;
        const n = document.getElementById('newName').value, img = document.getElementById('newImg').value;
        let obj = {}; if(n) obj.nickname = n; if(img) obj.photoURL = img;
        await db.collection("leaguePlayers").doc(id).update(obj);
        alert("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«");
    }

    async function setup() {
        const names = ["Ø§Ù„Ø£Ù‡Ù„ÙŠ", "Ø§Ù„Ø²Ù…Ø§Ù„Ùƒ", "Ø±ÙŠØ§Ù„ Ù…Ø¯Ø±ÙŠØ¯", "Ù…Ø§Ù† Ø³ÙŠØªÙŠ", "Ø¨Ø±Ø´Ù„ÙˆÙ†Ø©", "Ø¨Ø§ÙŠØ±Ù†", "Ù„ÙŠÙØ±Ø¨ÙˆÙ„", "Ø£Ø±Ø³Ù†Ø§Ù„", "Ø§Ù†ØªØ±", "Ø¨Ø§Ø±ÙŠØ³", "Ø§Ù„Ù†ØµØ±", "Ø§Ù„Ù‡Ù„Ø§Ù„", "Ø§Ù„Ø§ØªØ­Ø§Ø¯", "Ø±ÙˆÙ…Ø§", "Ù…ÙŠÙ„Ø§Ù†"];
        for(let i=0; i<names.length; i++) {
            await db.collection("leaguePlayers").doc("team_"+(i+1)).set({
                nickname: names[i], photoURL: "", pts:0, w:0, d:0, l:0, gf:0, ga:0, played:0, gd:0, order: i
            }, {merge: true});
        }
        alert("ØªÙ…Øª Ø§Ù„ØªÙ‡ÙŠØ¦Ø©!");
    }
    load();
</script>
</body>
</html>
