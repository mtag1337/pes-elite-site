<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PES ELITE | ADMIN COMMAND CENTER</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Orbitron:wght@600;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #00f2ff;
            --accent: #ff007a;
            --gold: #ffd700;
            --bg: #05050a;
            --panel: rgba(15, 15, 25, 0.8);
            --border: rgba(255, 255, 255, 0.1);
        }

        body {
            background: var(--bg);
            background-image: radial-gradient(circle at 50% 50%, #101020 0%, #05050a 100%);
            color: #fff;
            font-family: 'Cairo', sans-serif;
            margin: 0;
            padding: 20px;
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
            min-height: 100vh;
        }

        /* Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ù„ÙˆÙŠØ© */
        .admin-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto 40px;
        }

        .stat-card {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .stat-card i { font-size: 24px; color: var(--primary); margin-bottom: 10px; }
        .stat-card h4 { margin: 5px 0; font-size: 14px; color: #888; }
        .stat-card div { font-family: 'Orbitron'; font-size: 22px; font-weight: 900; color: #fff; }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .header-main {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .header-main h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 32px;
            letter-spacing: 2px;
            margin-bottom: 20px;
            text-shadow: 0 0 15px var(--primary);
        }

        .controls-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .search-wrapper { position: relative; width: 400px; }
        .search-wrapper i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--primary); }
        
        .search-box {
            width: 100%;
            background: var(--panel);
            border: 2px solid var(--border);
            padding: 12px 15px 12px 45px;
            border-radius: 30px;
            color: #fff;
            outline: none;
            transition: 0.3s;
        }
        .search-box:focus { border-color: var(--primary); box-shadow: 0 0 15px rgba(0, 242, 255, 0.2); }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† */
        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 25px;
            max-width: 1300px;
            margin: auto;
        }

        .player-card {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            position: relative;
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .player-card:hover {
            transform: translateY(-10px);
            border-color: var(--primary);
            background: rgba(20, 20, 40, 0.9);
        }

        .card-top { display: flex; align-items: center; gap: 20px; }

        .player-img-container {
            position: relative;
            width: 90px;
            height: 90px;
        }

        .player-img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary);
            padding: 3px;
        }

        .level-badge {
            position: absolute;
            bottom: -5px;
            right: -5px;
            background: var(--accent);
            color: #fff;
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 10px;
            font-family: 'Orbitron';
        }

        .info-main h3 { margin: 0; font-size: 20px; display: flex; align-items: center; gap: 8px; }
        .info-main p { margin: 5px 0; font-size: 13px; color: #aaa; }
        
        .verified-check { color: #00bfff; font-size: 16px; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 12px;
        }

        .stat-box { text-align: center; }
        .stat-label { font-size: 9px; color: #666; display: block; margin-bottom: 2px; }
        .stat-val { font-family: 'Orbitron'; font-size: 14px; color: var(--primary); }
        .power-val { color: var(--gold); }

        .card-actions {
            display: flex;
            gap: 10px;
            margin-top: 5px;
        }

        .btn-action {
            flex: 1;
            padding: 8px;
            border-radius: 8px;
            border: none;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .btn-verify { background: rgba(0, 191, 255, 0.1); color: #00bfff; border: 1px solid #00bfff; }
        .btn-verify:hover { background: #00bfff; color: #fff; }

        .btn-ban { background: rgba(255, 0, 122, 0.1); color: var(--accent); border: 1px solid var(--accent); }
        .btn-ban:hover { background: var(--accent); color: #fff; }

        /* Ø§Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø¸Ù‡ÙˆØ± */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .player-card { animation: fadeInUp 0.5s ease forwards; }
    </style>
</head>
<body>

<div class="header-main">
    <h1>PES ELITE <span style="color: var(--primary);">COMMAND CENTER</span></h1>
    <div class="controls-row">
        <div class="search-wrapper">
            <i class="fas fa-search"></i>
            <input type="text" id="searchInput" class="search-box" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ØŒ Ø§Ù„Ù€ IDØŒ Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ..." onkeyup="search()">
        </div>
    </div>
</div>

<div class="admin-dashboard">
    <div class="stat-card">
        <i class="fas fa-users"></i>
        <h4>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­Ø§Ø±Ø¨ÙŠÙ†</h4>
        <div id="totalPlayers">0</div>
    </div>
    <div class="stat-card">
        <i class="fas fa-check-double"></i>
        <h4>Ø­Ø³Ø§Ø¨Ø§Øª Ù…ÙˆØ«Ù‚Ø©</h4>
        <div id="verifiedPlayers">0</div>
    </div>
    <div class="stat-card">
        <i class="fas fa-coins"></i>
        <h4>Ø¥Ø¬Ù…Ø§Ù„ÙŠ GP Ø§Ù„Ù…ØªØ¯Ø§ÙˆÙ„</h4>
        <div id="totalGP">0</div>
    </div>
</div>

<div class="players-grid" id="playersContainer">
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCYAtj7gB7bfXPPSRojddCzhIyUMN7Tnow",
        authDomain: "pes-elite.firebaseapp.com",
        projectId: "pes-elite",
        storageBucket: "pes-elite.firebasestorage.app",
        messagingSenderId: "407069539120",
        appId: "1:407069539120:web:466249fa7f716266d9e6f5"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    const ADMIN_EMAIL = "mtag1337@gmail.com"; 
    const MASTER_PASS = "mtag1337@010#@010#";

    auth.onAuthStateChanged(user => {
        if (user && user.email === ADMIN_EMAIL) {
            let pass = sessionStorage.getItem('admin_session') || prompt("ğŸ” Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© - Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:");
            if (pass === MASTER_PASS) {
                sessionStorage.setItem('admin_session', MASTER_PASS);
                document.body.style.opacity = "1";
                loadPlayers();
            } else {
                alert("âŒ ÙˆØµÙˆÙ„ Ù…Ø±ÙÙˆØ¶! Ø³ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„Ùƒ.");
                window.location.href = "home.html";
            }
        } else {
            window.location.href = "login.html";
        }
    });

    function loadPlayers() {
        db.collection("players").orderBy("rank", "desc").onSnapshot(snap => {
            const container = document.getElementById('playersContainer');
            let totalGP = 0;
            let verifiedCount = 0;
            
            document.getElementById('totalPlayers').innerText = snap.size;
            container.innerHTML = "";

            snap.forEach(doc => {
                const p = doc.data();
                const gp = p.gpPoints || 0;
                const r = p.rank || 1000;
                const pwr = Math.floor(r + (gp * 0.1));
                const lvl = Math.floor((p.xp || 0) / 1000) + 1;
                
                totalGP += gp;
                if(p.isVerified) verifiedCount++;

                const verifiedHTML = p.isVerified ? '<i class="fas fa-check-circle verified-check"></i>' : '';

                container.innerHTML += `
                    <div class="player-card">
                        <div class="card-top">
                            <div class="player-img-container">
                                <img src="${p.photoURL || 'https://via.placeholder.com/90'}" class="player-img">
                                <div class="level-badge">LVL ${lvl}</div>
                            </div>
                            <div class="info-main">
                                <h3>${p.nickname} ${verifiedHTML}</h3>
                                <p><i class="fas fa-fingerprint"></i> ID: #${p.playerID || '0000'}</p>
                                <p><i class="fas fa-envelope"></i> ${p.email}</p>
                            </div>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-box">
                                <span class="stat-label">POWER</span>
                                <span class="stat-val power-val">${pwr}</span>
                            </div>
                            <div class="stat-box">
                                <span class="stat-label">RATING</span>
                                <span class="stat-val">${r}</span>
                            </div>
                            <div class="stat-box">
                                <span class="stat-label">GP</span>
                                <span class="stat-val">${gp}</span>
                            </div>
                        </div>

                        <div class="card-actions">
                            <button class="btn-action btn-verify" onclick="toggleVerify('${doc.id}', ${p.isVerified})">
                                <i class="fas fa-user-check"></i> ${p.isVerified ? 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙˆØ«ÙŠÙ‚' : 'ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø­Ø³Ø§Ø¨'}
                            </button>
                            <button class="btn-action btn-ban" onclick="banPlayer('${doc.id}')">
                                <i class="fas fa-user-slash"></i> Ø­Ø¸Ø±
                            </button>
                        </div>
                    </div>
                `;
            });

            document.getElementById('verifiedPlayers').innerText = verifiedCount;
            document.getElementById('totalGP').innerText = totalGP.toLocaleString();
        });
    }

    // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ­ÙƒÙ… (Ø£Ù…Ø«Ù„Ø© Ù„Ù„Ø±Ø¨Ø·)
    async function toggleVerify(id, currentStatus) {
        if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù„Ø§Ø¹Ø¨ØŸ")) {
            await db.collection("players").doc(id).update({ isVerified: !currentStatus });
        }
    }

    function banPlayer(id) {
        alert("ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø­Ø¸Ø± ØªØ­ØªØ§Ø¬ Ù„Ø±Ø¨Ø·Ù‡Ø§ Ø¨Ù€ Cloud Functions Ø£Ùˆ Ø­Ù‚Ù„ Ø®Ø§Øµ ÙÙŠ Ø§Ù„Ø¯Ø§ØªØ§ØŒ ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø±Ù: " + id);
    }

    function search() {
        let input = document.getElementById('searchInput').value.toLowerCase();
        let cards = document.getElementsByClassName('player-card');
        for (let card of cards) {
            let text = card.innerText.toLowerCase();
            card.style.display = text.includes(input) ? "flex" : "none";
        }
    }
</script>
</body>
</html>
