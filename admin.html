<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PES ELITE | Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¤Ù…Ù†Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --main: #eaff00; --bg: #050508; --card: #12121a; --error: #ff3333; }
        body { background: var(--bg); color: #fff; font-family: 'Cairo', sans-serif; margin: 0; min-height: 100vh; display: flex; justify-content: center; align-items: center; }
        .card { background: var(--card); border: 1px solid #333; border-radius: 15px; padding: 25px; margin-bottom: 20px; text-align: center; width: 100%; max-width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        input, select { width: 100%; background: #000; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 8px; margin-bottom: 15px; font-family: 'Cairo'; box-sizing: border-box; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; font-family: 'Cairo'; transition: 0.3s; }
        .btn-main { background: var(--main); color: #000; }
        
        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù…Ø®ÙÙŠØ© ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
        #admin-interface { display: none; width: 100%; max-width: 900px; padding: 20px; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .control-card { background: var(--card); border: 1px solid #222; border-radius: 15px; padding: 25px; margin-bottom: 20px; text-align: right; }
        h2 { color: var(--main); border-right: 4px solid var(--main); padding-right: 15px; margin-top: 0; }
    </style>
</head>
<body>

    <div id="step-google" class="card">
        <h2 style="border:none; text-align:center">ğŸ”’ Ø­Ù…Ø§ÙŠØ© PES ELITE</h2>
        <p>Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø³Ø§Ø¨ Ø¬ÙˆØ¬Ù„</p>
        <button class="btn btn-main" onclick="login()">Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Google</button>
        <p id="google-error" style="color:var(--error); font-size:0.8rem; margin-top:10px;"></p>
    </div>

    <div id="step-pass" class="card" style="display: none;">
        <h2 style="border:none; text-align:center">ğŸ” Ø­Ù…Ø§ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©</h2>
        <p>Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ù„ÙˆØ­Ø©</p>
        <input type="password" id="private-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø®Ø§ØµØ©">
        <button class="btn btn-main" onclick="verifyPrivatePass()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù‡ÙˆÙŠØ©</button>
        <p id="pass-error" style="color:var(--error); font-size:0.8rem; margin-top:10px;"></p>
    </div>

    <div id="admin-interface">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h1 style="color: var(--main); margin:0;">ğŸ® Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù†</h1>
            <button onclick="location.reload()" style="background:none; color:#888; border:1px solid #444; padding:5px 15px; cursor:pointer; border-radius:5px;">Ø®Ø±ÙˆØ¬ Ø¢Ù…Ù†</button>
        </div>

        <div id="setup-area" class="control-card" style="border-color: var(--main); display:none;">
            <h2>ğŸš¨ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠ</h2>
            <p>Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… ÙØ§Ø±ØºØ©ØŸ Ø§Ø¶ØºØ· Ù„Ø¥Ù†Ø´Ø§Ø¡ 15 Ø®Ø§Ù†Ø© Ø¬Ø¯ÙŠØ¯Ø©.</p>
            <button class="btn" style="background:#1a1a00; color:var(--main); border:1px dashed var(--main)" onclick="setupNewLeague()">Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯</button>
        </div>

        <div class="control-card">
            <h2>ğŸ“ ØªØ¹Ø¯ÙŠÙ„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</h2>
            <label>Ø§Ø®ØªØ± Ø§Ù„Ø®Ø§Ù†Ø©:</label>
            <select id="editSelect"></select>
            <input type="text" id="newName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯">
            <button class="btn" style="background:#fff; color:#000;" onclick="updateTeam()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¢Ù†</button>
        </div>

        <div class="control-card">
            <h2>âš½ ØªØ³Ø¬ÙŠÙ„ Ù†ØªÙŠØ¬Ø© Ù…Ø¨Ø§Ø±Ø§Ø©</h2>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
                <select id="t1"></select>
                <select id="t2"></select>
            </div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
                <input type="number" id="s1" placeholder="Ø£Ù‡Ø¯Ø§Ù 1">
                <input type="number" id="s2" placeholder="Ø£Ù‡Ø¯Ø§Ù 2">
            </div>
            <button class="btn btn-main" onclick="recordMatch()">Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ âœ…</button>
        </div>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCYAtj7gB7bfXPPSRojddCzhIyUMN7Tnow",
        authDomain: "pes-elite.firebaseapp.com",
        projectId: "pes-elite",
        storageBucket: "pes-elite.firebasestorage.app",
        messagingSenderId: "407069539120",
        appId: "1:407069539120:web:466249fa7f716266d9e6f5"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ù…Ø§ÙŠØ© ---
    const SECRET_KEY = "123456"; // <--- ØºÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù…Ù† Ù‡Ù†Ø§ Ø¨Ø±Ø§Ø­ØªÙƒ

    function login() {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider);
    }

    auth.onAuthStateChanged(user => {
        if (user && user.email === "mtag1337@gmail.com") {
            document.getElementById('step-google').style.display = 'none';
            document.getElementById('step-pass').style.display = 'block';
        } else if (user) {
            document.getElementById('google-error').innerText = "Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ù‡.";
            auth.signOut();
        }
    });

    function verifyPrivatePass() {
        const input = document.getElementById('private-pass').value;
        if (input === SECRET_KEY) {
            document.getElementById('step-pass').style.display = 'none';
            document.getElementById('admin-interface').style.display = 'block';
            loadData();
        } else {
            document.getElementById('pass-error').innerText = "ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙ„Ø·!";
        }
    }

    // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ­ÙƒÙ… ---
    function loadData() {
        db.collection("MainLeague").orderBy("id").onSnapshot(snap => {
            if (snap.empty) { document.getElementById('setup-area').style.display = 'block'; return; }
            document.getElementById('setup-area').style.display = 'none';
            let html = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙØ±ÙŠÙ‚ --</option>';
            snap.forEach(doc => { html += `<option value="${doc.id}">${doc.data().name}</option>`; });
            document.getElementById('t1').innerHTML = html;
            document.getElementById('t2').innerHTML = html;
            document.getElementById('editSelect').innerHTML = html;
        });
    }

    async function setupNewLeague() {
        if(!confirm("Ø¥Ù†Ø´Ø§Ø¡ 15 Ø®Ø§Ù†Ø©ØŸ")) return;
        for(let i=1; i<=15; i++) {
            await db.collection("MainLeague").doc("team"+i).set({ id: i, name: "ÙØ±ÙŠÙ‚ "+i, played: 0, pts: 0, gd: 0 });
        }
        alert("ØªÙ… Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚!");
    }

    async function updateTeam() {
        const id = document.getElementById('editSelect').value, name = document.getElementById('newName').value;
        if(!id || !name) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        await db.collection("MainLeague").doc(id).update({ name: name });
        alert("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«!");
        document.getElementById('newName').value = '';
    }

    async function recordMatch() {
        const id1 = document.getElementById('t1').value, id2 = document.getElementById('t2').value;
        const s1 = parseInt(document.getElementById('s1').value), s2 = parseInt(document.getElementById('s2').value);
        if(!id1 || !id2 || isNaN(s1)) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        
        const n1 = document.querySelector(`#t1 option[value="${id1}"]`).text;
        const n2 = document.querySelector(`#t2 option[value="${id2}"]`).text;

        await db.collection("AllMatches").add({ t1: n1, t2: n2, s1, s2, time: Date.now() });
        await updateStats(id1, s1, s2);
        await updateStats(id2, s2, s1);
        alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø©!");
    }

    async function updateStats(id, gf, ga) {
        const ref = db.collection("MainLeague").doc(id);
        const d = (await ref.get()).data();
        let w = gf > ga ? 1 : 0, dr = gf === ga ? 1 : 0;
        await ref.update({
            played: (d.played || 0) + 1,
            pts: (d.pts || 0) + (w * 3 + dr),
            gd: (d.gd || 0) + (gf - ga)
        });
    }
</script>
</body>
</html>
