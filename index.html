<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PES ELITE | DASHBOARD</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Orbitron:wght@600;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root {
    --primary: #00f2ff;
    --accent: #bc13fe;
    --bg-dark: #020205;
    --panel: rgba(15,15,25,0.95);
    --border: rgba(255,255,255,0.08);
    --gold: #ffcc00;
}

* { margin:0; padding:0; box-sizing:border-box; outline:none; }
body {
    font-family: 'Cairo', sans-serif;
    background: url('https://images.unsplash.com/photo-1598992697897-3c9d59392f3f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-4.0.3&q=80&w=1080') no-repeat center/cover;
    color:#fff;
    overflow-x:hidden;
}

nav {
    position: sticky;
    top:0;
    z-index:1000;
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:0 30px;
    height:80px;
    background: rgba(0,0,0,0.85);
    border-bottom:2px solid var(--primary);
}

.logo { font-family:'Orbitron'; font-size:28px; font-weight:900; }
.logo span { color: var(--primary); text-shadow:0 0 15px var(--primary); }

nav .profile-nav {
    display:flex;
    align-items:center;
    gap:20px;
}
nav .profile-nav img {
    width:55px; height:55px; border-radius:50%; border:2px solid var(--primary); object-fit:cover;
}

.app-container {
    display:grid;
    grid-template-columns: 340px 1fr 340px;
    gap:25px;
    padding:25px;
    max-width:1850px;
    margin:auto;
}

/* Panels */
.glass-panel {
    background: var(--panel);
    border:1px solid var(--border);
    border-radius:25px;
    padding:20px;
    margin-bottom:25px;
    transition:0.4s ease;
    position:relative;
}
.glass-panel:hover { border-color: var(--primary); box-shadow: 0 10px 40px rgba(0,242,255,0.1); }

.avatar-ring {
    width:150px;
    height:150px;
    margin:0 auto 15px;
    position:relative;
    padding:5px;
    border-radius:50%;
    background: linear-gradient(45deg, var(--primary), var(--accent));
}
.avatar-ring img {
    width:100%; height:100%;
    border-radius:50%;
    object-fit:cover;
    border:4px solid var(--bg-dark);
}

/* XP bar */
.xp-bar-bg { height:12px; background:#111; border-radius:10px; overflow:hidden; margin-top:8px; }
.xp-bar-fill { height:100%; background:linear-gradient(to right,var(--primary),var(--accent)); width:0%; transition:1.5s; }

/* Menu */
.menu-nav { display:flex; flex-direction:column; gap:10px; margin-top:20px; }
.menu-link {
    padding:16px 22px; border-radius:16px;
    color:#777; text-decoration:none;
    cursor:pointer; display:flex; align-items:center; gap:15px;
    transition:0.3s;
}
.menu-link:hover, .menu-link.active { background:rgba(0,242,255,0.1); color:var(--primary); }

/* Sections */
.section-view { display:none; animation:fadeIn 0.5s ease; }
.section-view.active { display:block; }
@keyframes fadeIn { from{opacity:0;} to{opacity:1;} }

/* Top Legends */
.top-legends-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:15px; margin:15px 0; }
.legend-card {
    background: rgba(0,0,0,0.4);
    border:1px solid rgba(255,255,255,0.05);
    border-top:3px solid var(--gold);
    border-radius:20px;
    padding:15px;
    text-align:center;
}

/* Tournaments & Leagues */
.tour-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:20px; }
.tour-item {
    background:#08080c; border-radius:20px;
    border:1px solid var(--border);
    overflow:hidden;
    transition:0.3s;
}
.tour-item:hover { transform:scale(1.03); border-color:var(--primary); }

/* Buttons */
.btn-league-mega, .btn-save {
    padding:18px 20px;
    border-radius:20px;
    text-align:center;
    cursor:pointer;
    border:none;
    font-weight:900;
    transition:0.3s;
}
.btn-league-mega {
    background: linear-gradient(135deg,#6200ea,#bc13fe);
    color:white;
}
.btn-league-mega:hover { transform:scale(1.05); }

/* Chat */
.chat-box { height:350px; overflow-y:auto; padding:10px; display:flex; flex-direction:column-reverse; background:rgba(0,0,0,0.3); border-radius:12px; }

/* Search */
input[type=text] { width:100%; padding:12px; border-radius:12px; border:1px solid #222; background:#000; color:#fff; margin-bottom:10px; }
</style>
</head>
<body>

<nav>
    <div class="logo">PES<span>ELITE</span></div>
    <div class="profile-nav">
        <div>
            <div style="font-size:10px;color:#444;">RATING</div>
            <div id="navRating" style="font-family:'Orbitron';color:var(--primary);font-size:20px;font-weight:900;">1000</div>
        </div>
        <img id="navUserImg" src="https://via.placeholder.com/55">
    </div>
</nav>

<div class="app-container">

<!-- Sidebar -->
<aside>
<div class="glass-panel" style="text-align:center;">
    <div class="avatar-ring">
        <img id="myAvatar" src="https://via.placeholder.com/150">
        <label for="imgFile" style="position:absolute;bottom:0;left:10px;background:var(--primary);color:#000;width:35px;height:35px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;"><i class="fas fa-camera"></i></label>
        <input type="file" id="imgFile" style="display:none" onchange="handleImg(this)">
    </div>
    <h2 id="myName">تحميل...</h2>
    <div id="myID" style="color: var(--primary); font-family:'Orbitron';">#00000000</div>
    <div class="xp-bar-bg"><div class="xp-bar-fill" id="xpFill"></div></div>
    <div style="display:flex;justify-content:space-between;font-size:11px;margin-top:5px;">
        <span>LEVEL <b id="myLvl">1</b></span>
        <span id="myXP">0/1000 XP</span>
    </div>
</div>

<div class="glass-panel">
    <div class="menu-nav">
        <div class="menu-link active" onclick="tab('dash',this)"><i class="fas fa-th-large"></i> لوحة التحكم</div>
        <div class="menu-link" onclick="tab('tours',this)"><i class="fas fa-trophy"></i> البطولات</div>
        <div class="menu-link" onclick="tab('acc',this)"><i class="fas fa-user-cog"></i> الحساب</div>
        <div class="menu-link" style="color:#ff4d4d;" onclick="auth.signOut()"><i class="fas fa-sign-out-alt"></i> خروج</div>
    </div>
</div>
</aside>

<!-- Main Content -->
<main>
<section id="dash-sec" class="section-view active">
    <h2><i class="fas fa-bullhorn" style="color:var(--gold)"></i> لوحة الإعلانات الرسمية</h2>
    <div id="announcementPanel" class="glass-panel" style="min-height:120px;overflow:auto;"></div>

    <h2><i class="fas fa-crown" style="color:var(--gold)"></i> أفضل 3 لاعبين</h2>
    <div class="top-legends-grid" id="topGrid"></div>

    <h2><i class="fas fa-bolt" style="color:var(--gold)"></i> البطولات المفتوحة</h2>
    <div id="homeTourGrid" class="tour-grid"></div>
</section>

<section id="tours-sec" class="section-view">
    <h2>مركز البطولات والدوريات</h2>
    <div id="fullTourGrid" class="tour-grid"></div>
</section>

<section id="acc-sec" class="section-view">
    <h2>إعدادات الحساب</h2>
    <div class="glass-panel">
        <input type="text" id="editName" placeholder="الاسم الجديد">
        <button class="btn-save" onclick="updateProfile()">تحديث الملف</button>
    </div>
</section>
</main>

<!-- Right Sidebar -->
<aside>
<button class="btn-league-mega" onclick="window.location.href='league.html'">
    <i class="fas fa-shield-halved" style="font-size:40px;"></i>
    <h3>LEAGUE HUB</h3>
</button>

<div class="glass-panel">
    <h3>الدردشة العامة</h3>
    <div class="chat-box" id="globalChat"></div>
    <div style="display:flex;gap:5px;margin-top:10px;">
        <input type="text" id="chatInp" placeholder="اكتب رسالة...">
        <button onclick="sendMsg()" style="background:var(--primary);border:none;padding:8px 12px;border-radius:8px;"><i class="fas fa-paper-plane"></i></button>
    </div>
</div>
</aside>

</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyCYAtj7gB7bfXPPSRojddCzhIyUMN7Tnow",
    authDomain: "pes-elite.firebaseapp.com",
    projectId: "pes-elite",
    storageBucket: "pes-elite.firebasestorage.app",
    messagingSenderId: "407069539120",
    appId: "1:407069539120:web:466249fa7f716266d9e6f5"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

let uID,userData;

auth.onAuthStateChanged(user=>{
    if(user){ uID=user.uid; syncUser(); }
    else { window.location.href="login.html"; }
});

function syncUser(){
    db.collection("players").doc(uID).onSnapshot(doc=>{
        if(!doc.exists) return;
        userData=doc.data();
        document.getElementById('myName').innerText=userData.nickname||"بدون اسم";
        document.getElementById('myID').innerText="#" + (userData.playerID||"0000");
        document.getElementById('navRating').innerText=userData.gpPoints||1000;
        if(userData.photoURL){
            document.getElementById('myAvatar').src=userData.photoURL;
            document.getElementById('navUserImg').src=userData.photoURL;
        }
        const xp=userData.xp||0;
        document.getElementById('myLvl').innerText=Math.floor(xp/1000)+1;
        document.getElementById('xpFill').style.width=(xp%1000/10)+"%";
        document.getElementById('myXP').innerText=`${xp%1000}/1000 XP`;
    });
    loadApp();
}

function loadApp(){
    // الإعلان الرسمي
    db.collection("announcements").orderBy("time","desc").onSnapshot(snap=>{
        let h="";
        snap.forEach(d=>{h+=`<div class="glass-panel" style="margin-bottom:8px;padding:8px;">${d.data().text}</div>`;});
        document.getElementById('announcementPanel').innerHTML=h;
    });

    // Top 3
    db.collection("players").orderBy("gpPoints","desc").limit(3).onSnapshot(snap=>{
        const topGrid=document.getElementById('topGrid'); topGrid.innerHTML="";
        snap.forEach(d=>{
            const p=d.data();
            topGrid.innerHTML+=`<div class="legend-card"><img src="${p.photoURL||'https://via.placeholder.com/100'}" style="width:80px;height:80px;border-radius:50%;"><h4>${p.nickname}</h4><p>LVL ${Math.floor((p.xp||0)/1000)+1}</p></div>`;
        });
    });

    // البطولات
    db.collection("tournaments").onSnapshot(snap=>{
        const h=document.getElementById('homeTourGrid'),f=document.getElementById('fullTourGrid'); h.innerHTML=f.innerHTML="";
        snap.forEach(doc=>{
            const t=doc.data();
            const card=`<div class="tour-item"><div style="padding:15px;"><h4>${t.title}</h4><p style="font-size:12px;color:#777">الجائزة: ${t.prize}</p><button class="btn-save" onclick="joinReq('${t.title}')">انضمام</button></div></div>`;
            f.innerHTML+=card; h.innerHTML+=card;
        });
    });

    // الشات
    db.collection("global_chat").orderBy("time","desc").limit(20).onSnapshot(snap=>{
        const box=document.getElementById('globalChat'); box.innerHTML="";
        snap.forEach(d=>{
            const m=d.data();
            box.innerHTML+=`<div style="margin-bottom:8px;background:rgba(255,255,255,0.03);padding:8px;border-radius:8px;"><b style="color:var(--primary)">${m.sender}:</b><br>${m.text}</div>`;
        });
    });
}

async function joinReq(tName){
    if(!userData) return;
    if(confirm(`هل تريد الانضمام لبطولة: ${tName}؟`)){
        await db.collection("playerRequests").add({
            uid:uID,
            playerName:userData.nickname,
            playerPhoto:userData.photoURL||"",
            tournamentName:tName,
            status:"pending",
            time:Date.now()
        });
        alert("تم إرسال طلبك بنجاح!");
    }
}

function sendMsg(){
    const inp=document.getElementById('chatInp');
    if(!inp.value.trim()) return;
    db.collection("global_chat").add({
        sender:userData.nickname,
        text:inp.value,
        time:firebase.firestore.FieldValue.serverTimestamp()
    });
    inp.value="";
}

function updateProfile(){
    const newName=document.getElementById('editName').value.trim();
    if(!newName){ alert("ادخل الاسم الجديد"); return; }
    db.collection("players").doc(uID).update({nickname:newName});
    alert("تم تحديث الاسم بنجاح!");
}

function tab(id,el){
    document.querySelectorAll('.section-view').forEach(s=>s.classList.remove('active'));
    document.getElementById(id+'-sec').classList.add('active');
    document.querySelectorAll('.menu-link').forEach(l=>l.classList.remove('active'));
    el.classList.add('active');
}

function handleImg(input){
    const file=input.files[0];
    if(!file) return;
    const reader=new FileReader();
    reader.onload=function(e){
        document.getElementById('myAvatar').src=e.target.result;
        document.getElementById('navUserImg').src=e.target.result;
        db.collection("players").doc(uID).update({photoURL:e.target.result});
    };
    reader.readAsDataURL(file);
}
</script>
</body>
</html>
