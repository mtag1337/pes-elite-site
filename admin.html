<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PES ELITE | Admin Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --main: #eaff00; --bg: #050508; --card: #12121a; --error: #ff3333; }
        body { background: var(--bg); color: #fff; font-family: 'Cairo', sans-serif; margin: 0; padding: 20px; }
        .wrapper { max-width: 900px; margin: auto; }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„ÙƒØ±ÙˆØª */
        .card { background: var(--card); border: 1px solid #222; border-radius: 15px; padding: 25px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h2 { color: var(--main); border-right: 4px solid var(--main); padding-right: 15px; font-weight: 900; }
        
        /* Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… */
        label { display: block; margin-bottom: 8px; color: #888; font-size: 0.9rem; }
        select, input { width: 100%; background: #000; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 8px; margin-bottom: 20px; font-family: 'Cairo'; outline: none; }
        select:focus, input:focus { border-color: var(--main); }

        .btn { width: 100%; padding: 15px; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; transition: 0.3s; font-size: 1rem; font-family: 'Cairo'; }
        .btn-save { background: var(--main); color: #000; }
        .btn-save:hover { background: #c8d900; transform: scale(1.02); }
        .btn-danger { background: none; border: 1px solid var(--error); color: var(--error); margin-top: 50px; }
        .btn-danger:hover { background: var(--error); color: #fff; }

        .nav-links { display: flex; gap: 10px; margin-bottom: 20px; }
        .nav-links a { text-decoration: none; color: #aaa; border: 1px solid #333; padding: 8px 15px; border-radius: 5px; font-size: 0.8rem; }
        .nav-links a:hover { color: var(--main); border-color: var(--main); }
    </style>
</head>
<body>

<div class="wrapper">
    <div class="nav-links">
        <a href="league.html" target="_blank">ğŸŒ ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø¹Ø§Ù…</a>
        <a href="all-matches.html" target="_blank">ğŸ“œ Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø§Øª</a>
    </div>

    <div class="card">
        <h2>âš½ ØªØ³Ø¬ÙŠÙ„ Ù†ØªÙŠØ¬Ø© Ù…Ø¨Ø§Ø±Ø§Ø©</h2>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div>
                <label>Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„ (ØµØ§Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¶)</label>
                <select id="t1"></select>
            </div>
            <div>
                <label>Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ (Ø§Ù„Ø¶ÙŠÙ)</label>
                <select id="t2"></select>
            </div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <input type="number" id="s1" placeholder="Ø£Ù‡Ø¯Ø§Ù Ø§Ù„ÙØ±ÙŠÙ‚ 1">
            <input type="number" id="s2" placeholder="Ø£Ù‡Ø¯Ø§Ù Ø§Ù„ÙØ±ÙŠÙ‚ 2">
        </div>
        <button class="btn btn-save" onclick="recordMatch()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù„Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ âœ…</button>
    </div>

    <div class="card">
        <h2>ğŸ“ Ø¥Ø¯Ø§Ø±Ø© Ù‡ÙˆÙŠØ© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</h2>
        <label>Ø§Ø®ØªØ± Ø§Ù„Ø®Ø§Ù†Ø© Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§</label>
        <select id="editSelect"></select>
        <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø§Ø¹Ø¨ Ø£Ùˆ Ø§Ù„ÙØ±ÙŠÙ‚</label>
        <input type="text" id="newName" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ù…Ø­Ù…Ø¯ ØµÙ„Ø§Ø­">
        <button class="btn" style="background: white; color: #000;" onclick="updateTeam()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¢Ù† ğŸ”„</button>
    </div>

    <button class="btn btn-danger" onclick="setupNewLeague()">ØªØµÙÙŠØ± Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ (Ø¯ÙˆØ±ÙŠ Ø¬Ø¯ÙŠØ¯) âš ï¸</button>
</div>



<script>
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyCYAtj7gB7bfXPPSRojddCzhIyUMN7Tnow",
        authDomain: "pes-elite.firebaseapp.com",
        projectId: "pes-elite",
        storageBucket: "pes-elite.firebasestorage.app",
        messagingSenderId: "407069539120",
        appId: "1:407069539120:web:466249fa7f716266d9e6f5"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    function init() {
        db.collection("MainLeague").orderBy("id").onSnapshot(snap => {
            let html = '<option value="">-- Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© --</option>';
            snap.forEach(doc => {
                html += `<option value="${doc.id}">${doc.data().name}</option>`;
            });
            document.getElementById('t1').innerHTML = html;
            document.getElementById('t2').innerHTML = html;
            document.getElementById('editSelect').innerHTML = html;
        });
    }

    async function recordMatch() {
        const id1 = document.getElementById('t1').value, id2 = document.getElementById('t2').value;
        const s1 = parseInt(document.getElementById('s1').value), s2 = parseInt(document.getElementById('s2').value);
        
        if(!id1 || !id2 || isNaN(s1)) return alert("ÙŠØ§ Ø¨Ø·Ù„ØŒ Ù„Ø§Ø²Ù… ØªØ®ØªØ§Ø± Ø§Ù„ÙØ±Ù‚ ÙˆØªØ­Ø· Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø£ÙˆÙ„!");
        if(id1 === id2) return alert("Ù…ÙŠÙ†ÙØ¹Ø´ Ø§Ù„ÙØ±ÙŠÙ‚ ÙŠÙ„Ø¹Ø¨ Ø¶Ø¯ Ù†ÙØ³Ù‡!");

        const n1 = document.querySelector(`#t1 option[value="${id1}"]`).text;
        const n2 = document.querySelector(`#t2 option[value="${id2}"]`).text;

        try {
            // 1. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø§ØªØ´
            await db.collection("AllMatches").add({ t1: n1, t2: n2, s1, s2, time: Date.now() });
            // 2. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            await updateStats(id1, s1, s2);
            await updateStats(id2, s2, s1);
            
            alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ±ØªÙŠØ¨ Ø¨Ù†Ø¬Ø§Ø­! ğŸ†");
            document.getElementById('s1').value = ''; document.getElementById('s2').value = '';
        } catch(e) { alert("ÙÙŠ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ù†ØªØŒ Ø¬Ø±Ø¨ ØªØ§Ù†ÙŠ."); }
    }

    async function updateStats(id, gf, ga) {
        const ref = db.collection("MainLeague").doc(id);
        const d = (await ref.get()).data();
        let win = gf > ga ? 1 : 0, draw = gf === ga ? 1 : 0;
        await ref.update({
            played: (d.played || 0) + 1,
            pts: (d.pts || 0) + (win * 3 + draw),
            gd: (d.gd || 0) + (gf - ga)
        });
    }

    async function updateTeam() {
        const id = document.getElementById('editSelect').value;
        const name = document.getElementById('newName').value;
        if(!id || !name) return alert("Ø§Ø®ØªØ± Ø§Ù„ÙØ±ÙŠÙ‚ ÙˆØ§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯.");
        await db.collection("MainLeague").doc(id).update({ name: name });
        alert("ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù… Ø¨Ù†Ø¬Ø§Ø­! âœ¨");
        document.getElementById('newName').value = '';
    }

    async function setupNewLeague() {
        if(!confirm("Ø£Ù†Øª ÙƒØ¯Ø© Ø¨ØªÙ…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ù…Ø§ØªØ´Ø§Øª ÙˆØ§Ù„ØªØ±ØªÙŠØ¨ Ø¹Ø´Ø§Ù† ØªØ¨Ø¯Ø£ Ø¯ÙˆØ±ÙŠ Ø¬Ø¯ÙŠØ¯.. Ù…ØªØ£ÙƒØ¯ØŸ")) return;
        const oldL = await db.collection("MainLeague").get();
        for(let doc of oldL.docs) await db.collection("MainLeague").doc(doc.id).delete();
        const oldH = await db.collection("AllMatches").get();
        for(let doc of oldH.docs) await db.collection("AllMatches").doc(doc.id).delete();
        
        for(let i=1; i<=15; i++) {
            await db.collection("MainLeague").doc("team"+i).set({ id: i, name: "ÙØ±ÙŠÙ‚ " + i, played: 0, pts: 0, gd: 0 });
        }
        alert("Ù…Ø¨Ø±ÙˆÙƒ! Ø¯ÙˆØ±ÙŠ Ø¬Ø¯ÙŠØ¯ ÙØ§Ø¶ÙŠ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù….");
    }

    init();
</script>
</body>
</html>
