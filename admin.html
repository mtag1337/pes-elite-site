<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠ | PES ELITE</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <style>
        body { background: #050508; color: white; font-family: sans-serif; padding: 15px; }
        .card { background: #111; padding: 15px; border-radius: 10px; border: 1px solid #333; margin-bottom: 20px; }
        select, input, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 6px; border: none; font-size: 1rem; }
        button { background: #eaff00; color: #000; font-weight: bold; cursor: pointer; }
        .reset-btn { background: #ff4d4d; color: white; font-size: 0.8rem; }
    </style>
</head>
<body>

    <h2 style="text-align:center">âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø§Ù…Ù„Ø©</h2>

    <div class="card">
        <h3>âš½ ØªØ³Ø¬ÙŠÙ„ Ù…Ø¨Ø§Ø±Ø§Ø© (Ø³ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø¯ÙˆØ±ÙŠ ÙˆØ§Ù„Ø£Ø±Ø´ÙŠÙ)</h3>
        <select id="t1"></select>
        <select id="t2"></select>
        <div style="display:flex; gap:10px;">
            <input type="number" id="s1" placeholder="Ø£Ù‡Ø¯Ø§Ù 1">
            <input type="number" id="s2" placeholder="Ø£Ù‡Ø¯Ø§Ù 2">
        </div>
        <button onclick="recordMatch()">Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ±ØªÙŠØ¨</button>
    </div>

    <div class="card">
        <h3>ğŸ“ ØªØ³Ù…ÙŠØ© Ø§Ù„ÙØ±Ù‚ (Ø§Ù„Ù€ 15 Ø®Ø§Ù†Ø©)</h3>
        <select id="editSelect"></select>
        <input type="text" id="newName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨/Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯">
        <input type="text" id="newLogo" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (Logo)">
        <button style="background:white" onclick="updateTeam()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ØµÙˆØ±Ø©</button>
    </div>

    <div class="card" style="text-align:center; border-color: red;">
        <h3>ğŸš¨ Ø¥Ø¹Ø¯Ø§Ø¯ Ø¯ÙˆØ±ÙŠ Ø¬Ø¯ÙŠØ¯</h3>
        <button class="reset-btn" onclick="createNewLeague()">Ø¥Ù†Ø´Ø§Ø¡ 15 Ø®Ø§Ù†Ø© Ø¯ÙˆØ±ÙŠ ÙØ§Ø±ØºØ© (ØªØµÙÙŠØ± Ø§Ù„ÙƒÙ„)</button>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCYAtj7gB7bfXPPSRojddCzhIyUMN7Tnow",
        authDomain: "pes-elite.firebaseapp.com",
        projectId: "pes-elite",
        storageBucket: "pes-elite.firebasestorage.app",
        messagingSenderId: "407069539120",
        appId: "1:407069539120:web:466249fa7f716266d9e6f5"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ±Ù‚ ÙÙŠ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
    function loadTeams() {
        db.collection("MainLeague").orderBy("id").onSnapshot(snap => {
            let html = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ±ÙŠÙ‚...</option>';
            snap.forEach(doc => {
                html += `<option value="${doc.id}">${doc.data().name}</option>`;
            });
            document.getElementById('t1').innerHTML = html;
            document.getElementById('t2').innerHTML = html;
            document.getElementById('editSelect').innerHTML = html;
        });
    }

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
    async function recordMatch() {
        const id1 = document.getElementById('t1').value, id2 = document.getElementById('t2').value;
        const sc1 = parseInt(document.getElementById('s1').value), sc2 = parseInt(document.getElementById('s2').value);
        if(!id1 || !id2 || isNaN(sc1) || isNaN(sc2)) return alert("Ø¨Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒØ§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

        const n1 = document.querySelector(`#t1 option[value="${id1}"]`).text;
        const n2 = document.querySelector(`#t2 option[value="${id2}"]`).text;

        // 1. ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ
        await db.collection("AllMatchesHistory").add({ t1: n1, t2: n2, s1: sc1, s2: sc2, time: Date.now() });
        
        // 2. ØªØ­Ø¯ÙŠØ« Ù†Ù‚Ø§Ø· Ø§Ù„ÙØ±ÙŠÙ‚ÙŠÙ†
        await updateStats(id1, sc1, sc2);
        await updateStats(id2, sc2, sc1);
        
        alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!");
    }

    async function updateStats(id, gf, ga) {
        const ref = db.collection("MainLeague").doc(id);
        const d = (await ref.get()).data();
        let w = gf > ga ? 1 : 0, dr = gf === ga ? 1 : 0, l = gf < ga ? 1 : 0;
        await ref.update({
            played: (d.played || 0) + 1,
            w: (d.w || 0) + w, d: (d.d || 0) + dr, l: (d.l || 0) + l,
            gf: (d.gf || 0) + gf, ga: (d.ga || 0) + ga,
            pts: (d.pts || 0) + (w * 3 + dr),
            gd: (d.gd || 0) + (gf - ga)
        });
    }

    async function updateTeam() {
        const id = document.getElementById('editSelect').value;
        const name = document.getElementById('newName').value;
        const logo = document.getElementById('newLogo').value;
        if(!id) return alert("Ø§Ø®ØªØ± ÙØ±ÙŠÙ‚Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹");
        let obj = {}; if(name) obj.name = name; if(logo) obj.logo = logo;
        await db.collection("MainLeague").doc(id).update(obj);
        alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ±ÙŠÙ‚");
    }

    async function createNewLeague() {
        if(!confirm("Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆÙƒØ§ÙØ© Ø§Ù„Ù†ØªØ§Ø¦Ø¬! Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) return;
        const oldL = await db.collection("MainLeague").get();
        for(let doc of oldL.docs) await db.collection("MainLeague").doc(doc.id).delete();
        const oldH = await db.collection("AllMatchesHistory").get();
        for(let doc of oldH.docs) await db.collection("AllMatchesHistory").doc(doc.id).delete();
        
        for(let i=1; i<=15; i++) {
            await db.collection("MainLeague").doc("team"+i).set({
                id: i, name: "ÙØ±ÙŠÙ‚ " + i, logo: "", played: 0, w:0, d:0, l:0, gf:0, ga:0, pts: 0, gd: 0
            });
        }
        alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¯ÙˆØ±ÙŠ Ø¬Ø¯ÙŠØ¯ ÙØ§Ø±Øº!");
    }
    loadTeams();
</script>
</body>
</html>
