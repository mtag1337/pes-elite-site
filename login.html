<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PES ELITE | تسجيل الدخول</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Orbitron:wght@600;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root { --primary: #e1ff00; --bg: #050508; --panel: #111118; }
        body { background: var(--bg); color: white; font-family: 'Cairo', sans-serif; height: 100vh; display: flex; align-items: center; justify-content: center; margin: 0; overflow: hidden; }
        
        /* تأثير الخلفية المتحركة */
        .bg-glow { position: absolute; width: 300px; height: 300px; background: var(--primary); filter: blur(150px); opacity: 0.1; z-index: -1; animation: move 10s infinite alternate; }
        @keyframes move { from { transform: translate(-50%, -50%); } to { transform: translate(50%, 50%); } }

        .login-card { width: 90%; max-width: 400px; background: var(--panel); padding: 40px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.05); text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        
        .logo { font-family: 'Orbitron'; font-size: 30px; margin-bottom: 30px; font-weight: 900; }
        .logo span { color: var(--primary); }

        .input-group { text-align: right; margin-bottom: 20px; }
        .input-group label { display: block; margin-bottom: 8px; font-size: 14px; color: #888; }
        .input-group input { width: 100%; padding: 12px; background: #000; border: 1px solid #333; color: white; border-radius: 10px; font-family: 'Cairo'; }
        .input-group input:focus { border-color: var(--primary); outline: none; }

        .btn-login { width: 100%; padding: 15px; background: var(--primary); color: black; border: none; border-radius: 10px; font-weight: 900; cursor: pointer; font-size: 16px; margin-top: 10px; transition: 0.3s; }
        .btn-login:hover { transform: scale(1.02); filter: brightness(1.1); }

        .toggle-link { margin-top: 20px; font-size: 14px; color: #888; cursor: pointer; }
        .toggle-link span { color: var(--primary); font-weight: bold; }
        
        #errorMsg { color: #ff4d4d; font-size: 13px; margin-top: 15px; min-height: 20px; }
    </style>
</head>
<body>

<div class="bg-glow"></div>

<div class="login-card">
    <div class="logo">PES <span>ELITE</span></div>
    <h2 id="formTitle">تسجيل الدخول</h2>
    <p style="color: #666; font-size: 13px; margin-bottom: 30px;">مرحباً بك في مجتمع النخبة</p>

    <div class="input-group">
        <label>البريد الإلكتروني</label>
        <input type="email" id="email" placeholder="example@mail.com">
    </div>

    <div class="input-group">
        <label>كلمة المرور</label>
        <input type="password" id="pass" placeholder="••••••••">
    </div>

    <button class="btn-login" id="submitBtn" onclick="handleAuth()">دخول</button>
    
    <div class="toggle-link" onclick="toggleMode()">
        <p id="toggleText">ليس لديك حساب؟ <span>سجل الآن</span></p>
    </div>

    <p id="errorMsg"></p>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCYAtj7gB7bfXPPSRojddCzhIyUMN7Tnow",
        authDomain: "pes-elite.firebaseapp.com",
        projectId: "pes-elite",
        storageBucket: "pes-elite.firebasestorage.app",
        messagingSenderId: "407069539120",
        appId: "1:407069539120:web:466249fa7f716266d9e6f5"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let isLogin = true;

    function toggleMode() {
        isLogin = !isLogin;
        document.getElementById('formTitle').innerText = isLogin ? "تسجيل الدخول" : "إنشاء حساب جديد";
        document.getElementById('submitBtn').innerText = isLogin ? "دخول" : "تسجيل";
        document.getElementById('toggleText').innerHTML = isLogin ? "ليس لديك حساب؟ <span>سجل الآن</span>" : "لديك حساب بالفعل؟ <span>سجل دخول</span>";
    }

    async function handleAuth() {
        const email = document.getElementById('email').value;
        const pass = document.getElementById('pass').value;
        const msg = document.getElementById('errorMsg');
        const btn = document.getElementById('submitBtn');

        if(!email || !pass) return msg.innerText = "يرجى ملء كافة الحقول";

        btn.disabled = true;
        msg.style.color = "var(--primary)";
        msg.innerText = "جاري التحقق...";

        try {
            if (isLogin) {
                // تسجيل الدخول
                await auth.signInWithEmailAndPassword(email, pass);
                window.location.href = "index.html";
            } else {
                // إنشاء حساب
                const res = await auth.createUserWithEmailAndPassword(email, pass);
                // تهيئة بيانات اللاعب في الداتابيز لأول مرة
                await db.collection("players").doc(res.user.uid).set({
                    email: email,
                    nickname: email.split('@')[0], // اسم مؤقت
                    rank: 1000,
                    gpPoints: 0,
                    photoURL: "",
                    isVerified: false,
                    playerID: Math.floor(100000 + Math.random() * 900000)
                });
                window.location.href = "profile.html"; // توجيهه للبروفايل لإكمال بياناته
            }
        } catch (error) {
            msg.style.color = "#ff4d4d";
            msg.innerText = "خطأ: " + error.message;
            btn.disabled = false;
        }
    }
</script>
</body>
</html>
