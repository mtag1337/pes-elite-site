<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PES ELITE | Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Orbitron:wght@600;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root {
    --primary: #00f2ff;
    --accent: #bc13fe;
    --bg-dark: #010103;
    --panel: rgba(20,20,35,0.95);
    --border: rgba(255,255,255,0.08);
    --gold: #ffcc00;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg-dark);color:#fff;font-family:'Cairo',sans-serif;overflow-x:hidden;}
nav{height:80px;background:var(--panel);display:flex;justify-content:space-between;align-items:center;padding:0 30px;position:sticky;top:0;z-index:1000;border-bottom:2px solid var(--primary);}
nav .logo{font-family:'Orbitron';font-size:28px;font-weight:900;}
nav .logo span{color:var(--primary);}
nav .user-info{display:flex;align-items:center;gap:15px;}
nav .user-info img{width:50px;height:50px;border-radius:50%;border:2px solid var(--primary);}
nav .user-info #rating{font-family:'Orbitron';font-weight:900;color:var(--primary);}

.container{display:grid;grid-template-columns:280px 1fr 280px;gap:20px;padding:20px;max-width:1800px;margin:auto;}
.panel{background:var(--panel);border:1px solid var(--border);border-radius:20px;padding:20px;overflow:hidden;transition:0.3s;}
.panel:hover{border-color:var(--primary);box-shadow:0 10px 30px rgba(0,242,255,0.1);}
.avatar{width:130px;height:130px;margin:0 auto;border-radius:50%;border:4px solid var(--primary);overflow:hidden;position:relative;}
.avatar img{width:100%;height:100%;object-fit:cover;}
.avatar label{position:absolute;bottom:0;left:10px;background:var(--primary);color:#000;width:35px;height:35px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;}
.section{display:none;}
.section.active{display:block;animation:fadeIn 0.5s ease;}
@keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
.menu{display:flex;flex-direction:column;gap:10px;margin-top:20px;}
.menu button{padding:12px 18px;border:none;border-radius:12px;color:#777;background:transparent;text-align:right;cursor:pointer;font-weight:700;display:flex;align-items:center;gap:10px;transition:0.2s;}
.menu button:hover, .menu button.active{color:var(--primary);}
.button-action{width:100%;padding:20px;border:none;border-radius:20px;font-weight:900;color:#fff;margin-bottom:20px;cursor:pointer;}
.btn-league{background:linear-gradient(135deg,#6200ea,#bc13fe);}
.top3-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin-top:20px;}
.top3-card{background:rgba(0,0,0,0.3);padding:15px;text-align:center;border-radius:15px;border-top:3px solid var(--gold);}
.tour-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:15px;margin-top:15px;}
.tour-card{background:#08080c;padding:15px;border-radius:15px;border:1px solid var(--border);}
input, textarea{background:#000;color:#fff;border:1px solid #222;padding:10px;border-radius:10px;width:100%;}
.chat-box{height:300px;overflow-y:auto;padding:10px;display:flex;flex-direction:column-reverse;border:1px solid var(--border);border-radius:12px;background:rgba(0,0,0,0.2);}
</style>
</head>
<body>

<nav>
    <div class="logo">PES<span>ELITE</span></div>
    <div class="user-info">
        <div id="rating">1000</div>
        <img id="userAvatar" src="https://via.placeholder.com/50">
    </div>
</nav>

<div class="container">
    <!-- Sidebar -->
    <aside>
        <div class="panel" style="text-align:center;">
            <div class="avatar">
                <img id="profilePic" src="https://via.placeholder.com/130">
                <label for="uploadPic"><i class="fas fa-camera"></i></label>
                <input type="file" id="uploadPic" style="display:none" onchange="updateAvatar(this)">
            </div>
            <h2 id="username">تحميل...</h2>
            <div id="userID" style="color:var(--primary);font-family:'Orbitron';">#00000000</div>
        </div>
        <div class="panel menu">
            <button class="active" onclick="switchTab('dashboard',this)"><i class="fas fa-th-large"></i> لوحة التحكم</button>
            <button onclick="switchTab('tournaments',this)"><i class="fas fa-trophy"></i> البطولات</button>
            <button onclick="switchTab('profile',this)"><i class="fas fa-user-cog"></i> البروفايل</button>
            <button style="color:#ff4d4d;" onclick="logout()"><i class="fas fa-sign-out-alt"></i> خروج</button>
        </div>
    </aside>

    <!-- Main Content -->
    <main>
        <!-- Dashboard -->
        <section id="dashboard" class="section active">
            <h2><i class="fas fa-crown" style="color:var(--gold)"></i> أفضل 3 لاعبين</h2>
            <div class="top3-grid" id="topPlayers"></div>

            <h3>البطولات المفتوحة</h3>
            <div class="tour-grid" id="openTournaments"></div>

            <div class="panel">
                <h3>لوحة الإعلانات</h3>
                <textarea id="announcements" rows="4" placeholder="اكتب هنا ليظهر للمستخدمين..."></textarea>
                <button class="button-action btn-league" onclick="saveAnnouncement()">حفظ الإعلان</button>
            </div>
        </section>

        <!-- Tournaments Section -->
        <section id="tournaments" class="section">
            <h2>مركز البطولات الكامل</h2>
            <div class="tour-grid" id="allTournaments"></div>
        </section>

        <!-- Profile Section -->
        <section id="profile" class="section">
            <h2>إعدادات الحساب</h2>
            <div class="panel">
                <input type="text" id="editName" placeholder="الاسم الجديد">
                <button class="button-action btn-league" onclick="updateProfile()">تحديث الاسم</button>
            </div>
        </section>
    </main>

    <!-- Right Sidebar -->
    <aside>
        <button class="button-action btn-league" onclick="window.location.href='league.html'">
            <i class="fas fa-shield-halved" style="font-size:30px"></i>
            <h3>LEAGUE HUB</h3>
        </button>

        <div class="panel">
            <h3>الدردشة العامة</h3>
            <div class="chat-box" id="chatBox"></div>
            <div style="display:flex;gap:5px;margin-top:10px;">
                <input type="text" id="chatInput" placeholder="اكتب رسالة...">
                <button onclick="sendMessage()" style="background:var(--primary);border:none;padding:8px 12px;border-radius:8px;"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </aside>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCYAtj7gB7bfXPPSRojddCzhIyUMN7Tnow",
  authDomain: "pes-elite.firebaseapp.com",
  projectId: "pes-elite",
  storageBucket: "pes-elite.firebasestorage.app",
  messagingSenderId: "407069539120",
  appId: "1:407069539120:web:466249fa7f716266d9e6f5"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();
let uID,userData;

auth.onAuthStateChanged(user=>{
    if(user){ uID=user.uid; loadUser(); }
    else{ window.location.href="login.html"; }
});

function loadUser(){
    db.collection("players").doc(uID).onSnapshot(doc=>{
        if(!doc.exists) return;
        userData=doc.data();
        document.getElementById('username').innerText=userData.nickname||"بدون اسم";
        document.getElementById('userID').innerText="#" + (userData.playerID||"0000");
        document.getElementById('rating').innerText=userData.gpPoints||1000;
        if(userData.photoURL){
            document.getElementById('profilePic').src=userData.photoURL;
            document.getElementById('userAvatar').src=userData.photoURL;
        }
    });
    loadTopPlayers();
    loadTournaments();
    loadChat();
}

function updateProfile(){
    const newName=document.getElementById('editName').value.trim();
    if(!newName) return alert("اكتب الاسم الجديد");
    db.collection("players").doc(uID).update({nickname:newName});
    alert("تم تحديث الاسم بنجاح!");
}

function updateAvatar(input){
    const file=input.files[0];
    if(!file) return;
    const reader=new FileReader();
    reader.onload=function(e){ 
        db.collection("players").doc(uID).update({photoURL:e.target.result});
    }
    reader.readAsDataURL(file);
}

function switchTab(id,el){
    document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelectorAll('.menu button').forEach(b=>b.classList.remove('active'));
    el.classList.add('active');
}

// Top Players
function loadTopPlayers(){
    db.collection("players").orderBy("gpPoints","desc").limit(3).onSnapshot(snap=>{
        const container=document.getElementById('topPlayers');
        container.innerHTML="";
        snap.forEach(doc=>{
            const d=doc.data();
            container.innerHTML+=`<div class="top3-card"><img src="${d.photoURL||'https://via.placeholder.com/80'}" style="width:80px;height:80px;border-radius:50%;margin-bottom:10px;"><h4>${d.nickname}</h4><p>Points: ${d.gpPoints}</p></div>`;
        });
    });
}

// Tournaments
function loadTournaments(){
    db.collection("tournaments").onSnapshot(snap=>{
        const open=document.getElementById('openTournaments');
        const all=document.getElementById('allTournaments');
        open.innerHTML=""; all.innerHTML="";
        snap.forEach(doc=>{
            const t=doc.data();
            const card=`<div class="tour-card"><h4>${t.title}</h4><p>الجائزة: ${t.prize}</p><button class="button-action btn-league" onclick="joinTournament('${t.title}')">انضمام</button></div>`;
            open.innerHTML+=card; all.innerHTML+=card;
        });
    });
}

function joinTournament(name){
    if(confirm(`هل تريد الانضمام لبطولة ${name}?`)){
        db.collection("playerRequests").add({
            uid:uID,playerName:userData.nickname,playerPhoto:userData.photoURL||"",tournamentName:name,status:"pending",time:Date.now()
        });
        alert("تم إرسال طلب الانضمام!");
    }
}

// Announcements
function saveAnnouncement(){
    const text=document.getElementById('announcements').value.trim();
    if(!text) return alert("اكتب شيء للإعلان");
    db.collection("announcements").doc("main").set({text});
    alert("تم الحفظ!");
}

// Chat
function loadChat(){
    db.collection("global_chat").orderBy("time","desc").limit(20).onSnapshot(snap=>{
        const box=document.getElementById('chatBox'); box.innerHTML="";
        snap.forEach(d=>{
            const m=d.data();
            box.innerHTML+=`<div style="margin-bottom:8px;background:rgba(255,255,255,0.03);padding:8px;border-radius:8px;"><b style="color:var(--primary)">${m.sender}:</b> ${m.text}</div>`;
        });
    });
}

function sendMessage(){
    const inp=document.getElementById('chatInput');
    if(!inp.value.trim()) return;
    db.collection("global_chat").add({sender:userData.nickname,text:inp.value,time:firebase.firestore.FieldValue.serverTimestamp()});
    inp.value="";
}

function logout(){ auth.signOut(); }
</script>
</body>
</html>
