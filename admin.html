<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>PES ELITE | MASTER CONTROL</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600;900&display=swap" rel="stylesheet">
    
    <style>
        :root { --main: #00ff88; --bg: #050507; --card: #111116; --danger: #ff3e3e; --accent: #00f2ff; }
        body { background: var(--bg); color: white; font-family: 'Cairo', sans-serif; margin: 0; display: flex; height: 100vh; opacity: 0; transition: opacity 0.5s; }
        .sidebar { width: 260px; background: var(--card); border-left: 1px solid #222; padding: 20px; display: flex; flex-direction: column; }
        .nav-btn { padding: 15px; margin: 5px 0; border-radius: 12px; cursor: pointer; border: 1px solid transparent; background: none; color: #888; text-align: right; font-size: 16px; font-weight: bold; transition: 0.3s; width: 100%; }
        .nav-btn.active { background: rgba(0, 255, 136, 0.1); color: var(--main); border-color: var(--main); }
        .workspace { flex: 1; padding: 30px; overflow-y: auto; }
        .section { display: none; }
        .active-sec { display: block; }
        .card { background: var(--card); padding: 20px; border-radius: 15px; border: 1px solid #222; margin-bottom: 20px; }
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; background: #000; border: 1px solid #333; color: #fff; border-radius: 8px; font-family: 'Cairo'; box-sizing: border-box; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-family: 'Cairo'; transition: 0.3s; }
        .btn-main { background: var(--main); color: #000; }
        .btn-danger { background: var(--danger); color: #fff; border-radius: 5px; padding: 8px 15px; cursor: pointer; border:none; }
        table { width: 100%; border-collapse: collapse; background: #000; border-radius: 10px; overflow: hidden; }
        th { background: #111; color: var(--main); padding: 12px; }
        td { padding: 10px; border-bottom: 1px solid #222; text-align: center; }
        .badge { background: var(--danger); color: white; padding: 2px 8px; border-radius: 10px; font-size: 12px; float: left; }
    </style>
</head>
<body>

<aside class="sidebar">
    <h2 style="color:var(--main); text-align:center;">PES ADMIN</h2>
    <button class="nav-btn active" onclick="openSec('dashSec', this)"><i class="fas fa-chart-bar"></i> Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
    <button class="nav-btn" onclick="openSec('tourSec', this)"><i class="fas fa-trophy"></i> Ø¨Ø·ÙˆÙ„Ø§Øª Ø§Ù„Ù‡ÙˆÙ…</button>
    <button class="nav-btn" onclick="openSec('playerSec', this)"><i class="fas fa-users"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</button>
    <button class="nav-btn" onclick="openSec('matchSec', this)"><i class="fas fa-gamepad"></i> Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù€ 60 Ù…Ø¨Ø§Ø±Ø§Ø©</button>
    <button class="nav-btn" onclick="openSec('configSec', this)"><i class="fas fa-crown"></i> Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ ÙˆØ§Ù„Ø£Ø®Ø¨Ø§Ø±</button>
    <button class="nav-btn" onclick="openSec('reqSec', this)"><i class="fas fa-envelope"></i> Ø§Ù„Ø·Ù„Ø¨Ø§Øª <span id="reqBadge" class="badge">0</span></button>
    <button class="btn btn-danger" onclick="firebase.auth().signOut()" style="margin-top:auto">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
</aside>

<main class="workspace">
    <div id="dashSec" class="section active-sec">
        <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:20px;">
            <div class="card"><h3>Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</h3><p id="countPlayers" style="font-size:32px; color:var(--main)">0</p></div>
            <div class="card"><h3>Ø§Ù„Ø¨Ø·ÙˆÙ„Ø§Øª</h3><p id="countTours" style="font-size:32px; color:var(--accent)">0</p></div>
            <div class="card"><h3>Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3><p id="countReqs" style="font-size:32px; color:var(--danger)">0</p></div>
        </div>
    </div>

    <div id="tourSec" class="section">
        <div class="card">
            <h3>Ù†Ø´Ø± Ø¨Ø·ÙˆÙ„Ø© Ù„Ù„Ù‡ÙˆÙ…</h3>
            <input type="text" id="tTitle" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©">
            <input type="text" id="tPrize" placeholder="Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©">
            <input type="text" id="tTime" placeholder="ÙˆÙ‚Øª Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©">
            <select id="tPlatform"><option>Mobile</option><option>Console</option></select>
            <button class="btn btn-main" onclick="addTour()">Ù†Ø´Ø± Ø§Ù„Ø¨Ø·ÙˆÙ„Ø© ÙÙˆØ±Ø§Ù‹</button>
        </div>
        <div id="activeToursList"></div>
    </div>

    <div id="playerSec" class="section">
        <div class="card">
            <h3>Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¯ÙˆØ±ÙŠ</h3>
            <input type="text" id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨">
            <input type="text" id="pID" placeholder="Ø§Ù„Ù€ ID Ø§Ù„Ø®Ø§Øµ">
            <button class="btn btn-main" onclick="addPlayer()">ØªØ«Ø¨ÙŠØª Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙÙŠ Ø§Ù„Ø¯ÙˆØ±ÙŠ</button>
        </div>
        <div id="playersList"></div>
    </div>

    <div id="matchSec" class="section">
        <div class="card" style="max-height: 80vh; overflow-y: auto;">
            <h3>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (60 Ù…Ø¨Ø§Ø±Ø§Ø©)</h3>
            <table>
                <thead><tr><th>#</th><th>Ù„Ø§Ø¹Ø¨ 1</th><th>Ø§Ù„Ù†ØªÙŠØ¬Ø©</th><th>Ù„Ø§Ø¹Ø¨ 2</th><th>Ø­ÙØ¸</th></tr></thead>
                <tbody id="matchTable"></tbody>
            </table>
        </div>
    </div>

    <div id="configSec" class="section">
        <div class="card">
            <h3>Ø£ÙØ¶Ù„ 3 Ù„Ø§Ø¹Ø¨ÙŠÙ†</h3>
            <label>Ø§Ù„Ø£ÙˆÙ„ ğŸ¥‡</label><select id="top1"></select>
            <label>Ø§Ù„Ø«Ø§Ù†ÙŠ ğŸ¥ˆ</label><select id="top2"></select>
            <label>Ø§Ù„Ø«Ø§Ù„Ø« ğŸ¥‰</label><select id="top3"></select>
            <button class="btn btn-main" onclick="saveTop3()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø¨Ø·Ø§Ù„</button>
        </div>
        <div class="card">
            <h3>Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…ØªØ­Ø±Ùƒ</h3>
            <textarea id="newsInput" rows="3" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø®Ø¨Ø± Ù‡Ù†Ø§..."></textarea>
            <button class="btn btn-main" onclick="saveNews()">ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</button>
        </div>
    </div>

    <div id="reqSec" class="section">
        <h1>Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</h1>
        <div id="requestsList"></div>
    </div>
</main>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCYAtj7gB7bfXPPSRojddCzhIyUMN7Tnow",
        authDomain: "pes-elite.firebaseapp.com",
        projectId: "pes-elite",
        storageBucket: "pes-elite.firebasestorage.app",
        messagingSenderId: "407069539120",
        appId: "1:407069539120:web:466249fa7f716266d9e6f5"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    const ADMIN_EMAIL = "mtag1337@gmail.com";
    const MASTER_PASS = "mtag1337@010#@010#";

    auth.onAuthStateChanged(user => {
        if (user && user.email === ADMIN_EMAIL) {
            let pass = prompt("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠ Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„:");
            if (pass === MASTER_PASS) {
                document.body.style.opacity = "1";
                startAdminApp();
            } else {
                alert("Ø±Ù…Ø² Ø®Ø§Ø·Ø¦!");
                auth.signOut();
            }
        } else {
            window.location.href = "login.html";
        }
    });

    function openSec(id, btn) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active-sec'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active-sec');
        btn.classList.add('active');
        if(id === 'matchSec') buildMatchTable();
    }

    function startAdminApp() {
        loadPlayers();
        loadTournaments();
        loadRequests();
        loadSettings();
    }

    // --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ---
   let playersCache = [];

    function loadPlayers() {
        // ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ØµØ­ÙŠØ­ ÙƒÙ…Ø§ Ù‡Ùˆ ÙÙŠ Ø§Ù„ØµÙˆØ±Ø© Ø¹Ù†Ø¯Ùƒ (leaguePlayers)
        db.collection("leaguePlayers").onSnapshot(snap => {
            const list = document.getElementById('playersList');
            const countEl = document.getElementById('countPlayers');
            
            if (countEl) countEl.innerText = snap.size;
            if (!list) return;

            list.innerHTML = "";
            playersCache = [];
            
            // Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ù„Ù„Ø¬Ø¯ÙˆÙ„ ÙˆÙ„Ù„Ø£Ø¨Ø·Ø§Ù„
            let opts = '<option value="">-- Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨ --</option>';

            snap.forEach(doc => {
                const p = doc.data();
                playersCache.push(p);
                opts += `<option value="${p.name}">${p.name}</option>`;
                
                list.innerHTML += `
                    <div class="card" style="margin-bottom:5px; padding:10px; display:flex; justify-content:space-between; align-items:center; border-right:4px solid var(--main)">
                        <span><strong>${p.name}</strong> (ID: ${p.id})</span>
                        <button onclick="delDoc('leaguePlayers','${doc.id}')" class="btn-danger">Ø­Ø°Ù ğŸ—‘ï¸</button>
                    </div>`;
            });

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… ÙÙŠ Ù‚Ø³Ù… Ø§Ù„Ø£Ø¨Ø·Ø§Ù„
            if(document.getElementById('top1')) document.getElementById('top1').innerHTML = opts;
            if(document.getElementById('top2')) document.getElementById('top2').innerHTML = opts;
            if(document.getElementById('top3')) document.getElementById('top3').innerHTML = opts;

            // Ø£Ù‡Ù… Ø®Ø·ÙˆØ©: Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø¨Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            console.log("ØªÙ… ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†ØŒ Ø¬Ø§Ø±ÙŠ Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„...");
            buildMatchTable(); 
        });
    }

    function buildMatchTable() {
        const table = document.getElementById('matchTable');
        if(!table) return;
        
        table.innerHTML = "";
        
        // Ø¨Ù†Ø§Ø¡ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØ§Ø­ ÙÙŠ Ø§Ù„ÙƒØ§Ø´
        let playerOpts = '<option value="">-- Ù„Ø§Ø¹Ø¨ --</option>';
        if (playersCache.length > 0) {
            playerOpts += playersCache.map(p => `<option value="${p.name}">${p.name}</option>`).join('');
        }
        
        for(let i=1; i<=60; i++) {
            table.innerHTML += `<tr>
                <td>${i}</td>
                <td><select id="m${i}p1">${playerOpts}</select></td>
                <td><input type="number" id="m${i}s1" style="width:45px; background:#000; border:1px solid #333; color:#fff;"> : <input type="number" id="m${i}s2" style="width:45px; background:#000; border:1px solid #333; color:#fff;"></td>
                <td><select id="m${i}p2">${playerOpts}</select></td>
                <td><button onclick="saveMatch(${i})" style="background:var(--main); border:none; padding:5px 12px; cursor:pointer; border-radius:5px; font-weight:bold;">Ø­ÙØ¸</button></td>
            </tr>`;
        }
        loadExistingMatches();
    }

    async function loadExistingMatches() {
        const snap = await db.collection("leagueMatches").get();
        snap.forEach(doc => {
            const m = doc.data();
            const n = m.matchNum;
            if(document.getElementById(`m${n}p1`)) {
                document.getElementById(`m${n}p1`).value = m.player1;
                document.getElementById(`m${n}p2`).value = m.player2;
                document.getElementById(`m${n}s1`).value = m.score1;
                document.getElementById(`m${n}s2`).value = m.score2;
            }
        });
    }

    async function saveMatch(n) {
        await db.collection("leagueMatches").doc(`match_${n}`).set({
            player1: document.getElementById(`m${n}p1`).value,
            player2: document.getElementById(`m${n}p2`).value,
            score1: document.getElementById(`m${n}s1`).value || 0,
            score2: document.getElementById(`m${n}s2`).value || 0,
            matchNum: n
        });
        alert("ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© " + n);
    }

    // --- Ø§Ù„Ø¨Ø·ÙˆÙ„Ø§Øª ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª ---
    async function addTour() {
        const title = document.getElementById('tTitle').value;
        if(!title) return alert("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©");
        await db.collection("tournaments").add({
            title: title,
            prize: document.getElementById('tPrize').value,
            time: document.getElementById('tTime').value,
            platform: document.getElementById('tPlatform').value,
            date: Date.now()
        });
        alert("ğŸš€ ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø¨Ø·ÙˆÙ„Ø©");
    }

    function loadTournaments() {
        db.collection("tournaments").orderBy("date","desc").onSnapshot(snap => {
            const list = document.getElementById('activeToursList');
            document.getElementById('countTours').innerText = snap.size;
            list.innerHTML = "";
            snap.forEach(doc => {
                list.innerHTML += `<div class="card" style="margin-bottom:5px; padding:10px; display:flex; justify-content:space-between; align-items:center;">
                    <span>${doc.data().title}</span>
                    <button onclick="delDoc('tournaments','${doc.id}')" class="btn-danger">Ø­Ø°Ù</button>
                </div>`;
            });
        });
    }

    function loadRequests() {
        db.collection("playerRequests").onSnapshot(snap => {
            document.getElementById('reqBadge').innerText = snap.size;
            document.getElementById('countReqs').innerText = snap.size;
            const list = document.getElementById('requestsList');
            list.innerHTML = "";
            snap.forEach(doc => {
                const r = doc.data();
                list.innerHTML += `<div class="card" style="display:flex; justify-content:space-between; align-items:center;">
                    <span>${r.playerName} (ID: ${r.playerID}) - ${r.tournamentName}</span>
                    <button class="btn btn-main" style="width:auto; padding:5px 15px;" onclick="approve('${doc.id}','${r.playerName}','${r.playerID}')">Ù‚Ø¨ÙˆÙ„ âœ…</button>
                </div>`;
            });
        });
    }

    async function approve(docId, name, playerId) {
        await db.collection("leaguePlayers").doc(playerId).set({name: name, id: playerId});
        await db.collection("playerRequests").doc(docId).delete();
        alert("ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙˆÙ†Ù‚Ù„Ù‡ Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠ");
    }

    // --- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ---
    async function saveTop3() {
        await db.collection("settings").doc("top3").set({
            first: document.getElementById('top1').value,
            second: document.getElementById('top2').value,
            third: document.getElementById('top3').value
        });
        alert("ğŸ† ØªÙ… ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¨Ø·Ø§Ù„");
    }

    async function saveNews() {
        await db.collection("settings").doc("leagueConfig").set({ news: document.getElementById('newsInput').value }, {merge:true});
        alert("ğŸ“¢ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø®Ø¨Ø§Ø±");
    }

    async function loadSettings() {
        const newsDoc = await db.collection("settings").doc("leagueConfig").get();
        if(newsDoc.exists) document.getElementById('newsInput').value = newsDoc.data().news || "";
    }

    async function delDoc(col, id) { 
        if(confirm("Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØŸ")) { 
            await db.collection(col).doc(id).delete(); 
            alert("ØªÙ… Ø§Ù„Ø­Ø°Ù");
        } 
    }
</script>
</body>
</html>






































