<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PES ELITE | Ultimate Admin Dashboard</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --sidebar-width: 260px;
            --ef-blue: #0014d3;
            --ef-yellow: #eaff00;
            --ef-pink: #ff007a;
            --dark-bg: #0a0a0f;
            --card-bg: #16161f;
        }

        body {
            margin: 0; font-family: 'Cairo', sans-serif;
            background-color: var(--dark-bg); color: white;
            display: flex; min-height: 100vh;
        }

        /* Sidebar Style */
        .sidebar {
            width: var(--sidebar-width);
            background: #000; border-left: 1px solid #222;
            padding: 20px; position: fixed; height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            font-family: 'Orbitron'; font-size: 24px; color: var(--ef-yellow);
            text-align: center; margin-bottom: 30px; border-bottom: 2px solid var(--ef-pink);
            padding-bottom: 10px;
        }

        .nav-link {
            display: flex; align-items: center; gap: 15px;
            padding: 12px 15px; color: #aaa; text-decoration: none;
            border-radius: 8px; margin-bottom: 5px; transition: 0.3s;
            cursor: pointer; border: none; background: none; width: 100%;
        }

        .nav-link:hover, .nav-link.active {
            background: var(--ef-blue); color: white;
        }

        /* Main Content Area */
        .main-content {
            margin-right: var(--sidebar-width);
            flex: 1; padding: 30px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px; margin-bottom: 30px;
        }

        .stat-card {
            background: var(--card-bg); padding: 20px; border-radius: 15px;
            border-right: 5px solid var(--ef-yellow);
        }

        .stat-card i { font-size: 30px; color: var(--ef-yellow); margin-bottom: 10px; }
        .stat-card h3 { margin: 0; font-size: 14px; color: #888; }
        .stat-card p { margin: 5px 0 0; font-size: 24px; font-weight: 900; font-family: 'Orbitron'; }

        /* Sections Handling */
        .admin-section { display: none; animation: fadeIn 0.4s ease; }
        .admin-section.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Forms & Tables */
        .glass-panel {
            background: var(--card-bg); padding: 25px; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        input, select, button.btn-save {
            width: 100%; padding: 12px; margin: 10px 0;
            background: #222; border: 1px solid #444; color: white;
            border-radius: 8px; font-family: 'Cairo';
        }

        button.btn-save {
            background: var(--ef-pink); border: none; font-weight: 900; cursor: pointer;
        }

        button.btn-save:hover { background: #ff3399; }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { text-align: right; color: var(--ef-yellow); padding: 15px; border-bottom: 1px solid #333; }
        td { padding: 15px; border-bottom: 1px solid #222; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header">PES ADMIN</div>
        <button class="nav-link active" onclick="showSection('overview')"><i class="fas fa-chart-line"></i> نظرة عامة</button>
        <button class="nav-link" onclick="showSection('tournaments')"><i class="fas fa-trophy"></i> إدارة البطولات</button>
        <button class="nav-link" onclick="showSection('players')"><i class="fas fa-users"></i> اللاعبين والفرق</button>
        <button class="nav-link" onclick="showSection('matches')"><i class="fas fa-gamepad"></i> جدولة المباريات</button>
        <button class="nav-link" onclick="showSection('results')"><i class="fas fa-poll"></i> النتائج والترتيب</button>
        <button class="nav-link" onclick="showSection('news')"><i class="fas fa-bullhorn"></i> الإشعارات والأخبار</button>
        <button class="nav-link" style="margin-top: 50px; color: var(--ef-pink);" onclick="logout()"><i class="fas fa-sign-out-alt"></i> تسجيل الخروج</button>
    </div>

    <div class="main-content">
        
        <div id="overview" class="admin-section active">
            <h1 class="fade-in">الإحصائيات الحالية</h1>
            <div class="stats-grid">
                <div class="stat-card"><i class="fas fa-fire"></i><h3>بطولات جارية</h3><p id="count-tour">3</p></div>
                <div class="stat-card"><i class="fas fa-shield-alt"></i><h3>الفرق</h3><p id="count-teams">16</p></div>
                <div class="stat-card"><i class="fas fa-user-friends"></i><h3>لاعبين مسجلين</h3><p id="count-play">124</p></div>
                <div class="stat-card"><i class="fas fa-check-double"></i><h3>مباريات منتهية</h3><p id="count-match">45</p></div>
            </div>
        </div>

        <div id="news" class="admin-section">
            <div class="glass-panel">
                <h2><i class="fas fa-bullhorn"></i> التحكم في شريط الأخبار</h2>
                <p>النص الحالي سيظهر لجميع اللاعبين في صفحة الدوري</p>
                <input type="text" id="newsInput" placeholder="اكتب الخبر الجديد هنا...">
                <button class="btn-save" onclick="updateNews()">تحديث شريط الأخبار</button>
            </div>
        </div>

        <div id="results" class="admin-section">
            <div class="glass-panel">
                <h2><i class="fas fa-edit"></i> تسجيل نتيجة مباراة</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <input type="text" id="p1" placeholder="اسم اللاعب الأول">
                    <input type="text" id="p2" placeholder="اسم اللاعب الثاني">
                    <input type="number" id="s1" placeholder="أهداف الأول">
                    <input type="number" id="s2" placeholder="أهداف الثاني">
                </div>
                <button class="btn-save" style="background: var(--ef-blue);" onclick="saveMatch()">حفظ النتيجة ونشرها</button>
            </div>
        </div>

    </div>

    <script>
        // Firebase Configuration (تأكد من مطابقة بياناتك)
        const firebaseConfig = {
            apiKey: "AIzaSyCYAtj7gB7bfXPPSRojddCzhIyUMN7Tnow",
            authDomain: "pes-elite.firebaseapp.com",
            projectId: "pes-elite",
            storageBucket: "pes-elite.firebasestorage.app",
            messagingSenderId: "407069539120",
            appId: "1:407069539120:web:466249fa7f716266d9e6f5"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // حماية الصفحة: لو مش mtag1337 يطرده
        auth.onAuthStateChanged(user => {
            if (!user || user.email !== "mtag1337@gmail.com") {
                window.location.href = "login.html";
            }
        });

        // تنقل بين الأقسام
        function showSection(id) {
            document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        // تحديث الأخبار في الفايربيز
        async function updateNews() {
            const txt = document.getElementById('newsInput').value;
            if(!txt) return alert("اكتب حاجة الأول!");
            await db.collection("settings").doc("leagueConfig").set({ news: txt }, { merge: true });
            alert("تم تحديث شريط الأخبار بنجاح!");
        }

        // تسجيل مباراة جديدة وتحديث الجدول تلقائياً
        async function saveMatch() {
            const data = {
                player1: document.getElementById('p1').value,
                player2: document.getElementById('p2').value,
                score1: document.getElementById('s1').value,
                score2: document.getElementById('s2').value,
                time: firebase.firestore.FieldValue.serverTimestamp()
            };

            if(!data.player1 || !data.player2) return alert("املأ البيانات كاملة");

            await db.collection("leagueMatches").add(data);
            alert("تم تسجيل المباراة بنجاح والترتيب اتحدث!");
            // مسح الخانات
            document.getElementById('p1').value = ""; document.getElementById('p2').value = "";
        }

        function logout() { auth.signOut(); }
    </script>
</body>
</html>
